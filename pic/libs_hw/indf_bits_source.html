<html>
<head>
<title>JALcc SourceCode exporting of indf_bits_source.html</title>
</head>
<!-- Generated by SynEdit HTML exporter -->
<body text="#000000" bgcolor="#FFFFFF">
<pre>
<code><font  size=3 face="Courier New"><font color="#000080"><A href="indf_bits.jal">download&nbsp;indf_bits.jal</A>
</font><font color="#808080"><i>--
-- name    : indf.jal
-- author  : Javier Mart&iacute;nez
-- date    : 14-11-2001
-- purpose : indf procedures 
--
-- 21-dec-2001 : pos -&gt; 0..7
-- 
-- In this file: 
--	High_Address in [0..1]   0=banks0-1 1=banks2-3 
--      Low_Address  in [0..255]
--      Data         in [0..255]
--      Position     in [0..7]   0=LSBit 7=MSBit       
--      Result       out [False,True]     
-- 
--      Real address = 0x100 * High_Address + Low_Address
--      Real address in [0..511]
-- 
-- Byte oriented procedures:
-- 
--       _file_get ( byte in High_Address , 
--                   byte in Low_Address , 
--                   byte out Data )
--
--       _file_put ( byte in High_Address , 
--                   byte in Low_Address , 
--                   byte in Data )
--
-- Bit oriented procedures:
-- 
--       _file_bit_set ( byte in High_Address , 
--                       byte in Low_Address , 
--                       byte in Position )
--
--       _file_bit_clear ( byte in High_Address , 
--                         byte in Low_Address , 
--                         byte in Position )
--
--       _file_bit_Get ( byte in High_Address , 
--                       byte in Low_Address , 
--                       byte in Position
--                       bit out Result )
--

-- include 16F877_20
-- include jpic


</i></font><b>procedure </b><font color="#000080">_file_get<b>( </b></font><b>byte in </b><font color="#000080">Haddr <b>, </b></font><b>byte in </b><font color="#000080">Laddr <b>, </b></font><b>byte out </b><font color="#000080">data <b>) </b></font><b>is </b><font color="#000080">begin 
</font><b>var volatile bit </b><font color="#000080">local_irp
</font><b>var volatile bit </b><font color="#000080">HAddr0 </font><b>at </b><font color="#000080">Haddr <b>: </b></font><font color="#FF0000">0
   </font><font color="#000080">local_irp <b>= </b>IRP
   IRP <b>= </b>HAddr0
   fsr <b>= </b>Laddr
   data <b>= </b>INDF
   IRP <b>= </b>local_irp
</font><b>end procedure

procedure </b><font color="#000080">_file_put<b>( </b></font><b>byte in </b><font color="#000080">Haddr <b>, </b></font><b>byte in </b><font color="#000080">Laddr <b>, </b></font><b>byte in </b><font color="#000080">data <b>) </b></font><b>is </b><font color="#000080">begin 
</font><b>var volatile bit </b><font color="#000080">local_irp
</font><b>var volatile bit </b><font color="#000080">HAddr0 </font><b>at </b><font color="#000080">Haddr <b>: </b></font><font color="#FF0000">0
   </font><font color="#000080">local_irp <b>= </b>IRP
   IRP <b>= </b>HAddr0
   fsr <b>= </b>Laddr
   INDF <b>= </b>data
   IRP <b>= </b>local_irp
</font><b>end procedure

procedure </b><font color="#000080">_file_bit_set <b>( </b></font><b>byte in </b><font color="#000080">Haddr <b>, </b></font><b>byte in </b><font color="#000080">Laddr <b>, </b></font><b>byte in </b><font color="#000080">pos <b>) </b></font><b>is </b><font color="#000080">begin 
</font><b>var volatile bit </b><font color="#000080">local_irp
</font><b>var volatile bit </b><font color="#000080">HAddr0 </font><b>at </b><font color="#000080">Haddr <b>: </b></font><font color="#FF0000">0
</font><b>var volatile byte </b><font color="#000080">temp1 <b>, </b>temp2
   local_irp <b>= </b>IRP
   IRP <b>= </b>HAddr0
   fsr <b>= </b>Laddr
   temp1 <b>= </b>INDF
   temp2 <b>= </b></font><font color="#FF0000">0x01
   </font><font color="#000080">c <b>= </b></font><b>low
   </b><font color="#000080">temp2 <b>= </b>temp2 <b>&lt;&lt; ( </b>pos <b>)
   </b>temp1 <b>= </b>temp1 <b>| </b>temp2
   INDF <b>= </b>temp1
   IRP <b>= </b>local_irp
</font><b>end procedure

procedure </b><font color="#000080">_file_bit_clear <b>( </b></font><b>byte in </b><font color="#000080">Haddr <b>, </b></font><b>byte in </b><font color="#000080">Laddr <b>, </b></font><b>byte in </b><font color="#000080">pos <b>) </b></font><b>is </b><font color="#000080">begin 
</font><b>var volatile bit </b><font color="#000080">local_irp
</font><b>var volatile bit </b><font color="#000080">HAddr0 </font><b>at </b><font color="#000080">Haddr <b>: </b></font><font color="#FF0000">0
</font><b>var volatile byte </b><font color="#000080">temp1 <b>, </b>temp2
   local_irp <b>= </b>IRP
   IRP <b>= </b>HAddr0
   fsr <b>= </b>Laddr
   temp1 <b>= </b>INDF
   temp2 <b>= </b></font><font color="#FF0000">0xFE
   </font><font color="#000080">c <b>= </b></font><b>high
   </b><font color="#000080">temp2 <b>= </b>temp2 <b>&lt;&lt; ( </b>pos <b>)
   </b>temp1 <b>= </b>temp1 <b>&amp; </b>temp2
   INDF <b>= </b>temp1
   IRP <b>= </b>local_irp
</font><b>end procedure

procedure </b><font color="#000080">_file_bit_get <b>( </b></font><b>byte in </b><font color="#000080">Haddr <b>, </b></font><b>byte in </b><font color="#000080">Laddr <b>, </b></font><b>byte in </b><font color="#000080">pos <b>, </b></font><b>bit out </b><font color="#000080">result <b>) </b></font><b>is </b><font color="#000080">begin 
</font><b>var volatile bit </b><font color="#000080">local_irp
</font><b>var volatile bit </b><font color="#000080">HAddr0 </font><b>at </b><font color="#000080">Haddr <b>: </b></font><font color="#FF0000">0
</font><b>var volatile byte </b><font color="#000080">temp1 <b>, </b>temp2
   result <b>= </b></font><font color="#FF0000">false
   </font><font color="#000080">local_irp <b>= </b>IRP
   IRP <b>= </b>HAddr0
   fsr <b>= </b>Laddr
   temp1 <b>= </b>INDF
   temp2 <b>= </b></font><font color="#FF0000">0x01
   </font><font color="#000080">C <b>= </b></font><b>low
   </b><font color="#000080">temp2 <b>= </b>temp2 <b>&lt;&lt; ( </b>pos <b>)
   </b>temp1 <b>= </b>temp1 <b>&amp; </b>temp2
   </font><b>if </b><font color="#000080">temp1 <b>!= </b></font><font color="#FF0000">0 </font><b>then 
    </b><font color="#000080">result <b>= </b></font><b>high
   end if
   </b><font color="#000080">IRP <b>= </b>local_irp
</font><b>end procedure



</b><font color="#808080"><i>;var byte ha,la,d
;var bit bitres


-- Real_address=0x195 Data=0x043
; ha = 0x01
; la = 0x95
; d  = 0x43

; _file_put ( ha , la , d )
; d = 0
; _file_get ( ha , la , d )
; pragma test assert d == 0x43


-- Real_address=0x195 Bit_0=low
; _file_bit_clear ( ha , la , 0x01 )


-- Real_address=0x195 Bit_0=high
; _file_bit_set ( ha , la , 0x03 )
; bitres = low


-- Real_address=0x195 Result=Bit_3
; _file_bit_get ( ha , la , 0x02 , bitres )
; pragma test assert bitres == high


-- Real_address=0x195 Result=Bit_1
; _file_bit_get ( ha , la , 0x00 , bitres )
; pragma test assert bitres == low
</i></font></font>
</code></pre>
</body>
</html>
