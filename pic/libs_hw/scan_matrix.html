<HTML><HEAD><TITLE>scan extended keymatrix</TITLE>
<STYLE type="text/css"><!--
BODY {
  margin: 5px 5px 5px 5px;
  background-color: #E8E8E8;
}

--></STYLE>
<LINK type="text/css" href="rvf.css" rel=STYLESHEET>
<link rel="icon" href="jalccring_small.gif" type="image/gif"></HEAD>
<BODY>

<P><SPAN class=RVTS1>scan extended keymatrix</SPAN></P>
<P><SPAN class=RVTS7>This html document is automatically generated by JALcc, from the JAL-sourcefile</SPAN></P>
<P><SPAN class=RVTS7>scan_matrix.jal&nbsp;&nbsp; 06-08-2004</SPAN></P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Description&nbsp;</SPAN></P>
<P>Scans the extended keymatrix and decodes multiple keys.&nbsp;</P>
<P>Every scan only 1 key is returned.&nbsp;</P>
<P>If a key is pressed during more than 1 scan, key = 0 (means no key) is inserted inbetween.&nbsp;</P>
<P>If multiple keys are pressed, every scan a higher key will be detected.&nbsp;</P>
<P>Example: if key 3 and 7 are pressed, succeeding scans will return (remark, here also the zero-key will be inserted)&nbsp;</P>
<P>3 , 7 , 0 , 3 , 7 , 0, 3&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P>for hardware details on the extended keymatrix, see&nbsp;</P>
<P>../PicProg/Pic_switch.htm&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Example Scan Matrix&nbsp;</SPAN></P>
<P>&nbsp;-- define the number of total scanlines (2 ... 5)&nbsp;</P>
<P>&nbsp;const byte key_nr_scanlines = 5&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;-- define the port where scanlines resides&nbsp;</P>
<P>&nbsp;-- (all scan lines must be on the same port)&nbsp;</P>
<P>&nbsp;var byte key_port is _portB&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;-- the scanmatrix must have pull-up resistors at all lines&nbsp;</P>
<P>&nbsp;-- the user must set the pull-ups active&nbsp;</P>
<P>&nbsp; _file_bit_clear ( high_OPTION_REG, low_OPTION_REG, 7 )&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;-- define the pinnumbers where the scanlines are&nbsp;</P>
<P>&nbsp;-- always define the maximum number of pins,&nbsp;</P>
<P>&nbsp;-- The scanlines not used, should be definied as an existing scanline&nbsp;</P>
<P>&nbsp;-- So if you have only 4 scanlines, define the fifth scanline as&nbsp;</P>
<P>&nbsp;--&nbsp;&nbsp;&nbsp; const key_scanpin_5 = key_scanpin_1&nbsp;</P>
<P>&nbsp;--&nbsp;</P>
<P>&nbsp;const key_scanpin_1 = 0&nbsp;</P>
<P>&nbsp;const key_scanpin_2 = 4&nbsp;</P>
<P>&nbsp;const key_scanpin_3 = 5&nbsp;</P>
<P>&nbsp;const key_scanpin_4 = 6&nbsp;</P>
<P>&nbsp;const key_scanpin_5 = 7&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;-- include scan library&nbsp;</P>
<P>&nbsp;include scan_matrix&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;var byte key&nbsp;</P>
<P>&nbsp;forever loop&nbsp;</P>
<P>&nbsp; -- scan keybord&nbsp;</P>
<P>&nbsp; scan_keymatrix_ext ( key )&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp; -- if a different key was pressed, execute the command&nbsp;</P>
<P>&nbsp; if key != 0 then&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp; asynch_send_hw(key)&nbsp;</P>
<P>&nbsp; end if&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp; ... do other things here, maybe a fixed delay ?&nbsp;</P>
<P>&nbsp;end loop&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>License&nbsp;</SPAN></P>
<P>freeware, under the terms of the GNU GPL&nbsp;</P>
<P>Copyright (C) 2002 Stef Mientki&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS1>Version History</SPAN></P>
<P><A class=RVTS4 href="scan_matrix.jal">download&nbsp; scan_matrix.jal</A></P>
<P><A class=RVTS4 href="scan_matrix_source.html">colorcoded HTML&nbsp; scan_matrix_source.html</A></P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version 1.1&nbsp;&nbsp; ,24-11-2001, Stef Mientki&nbsp;</SPAN></P>
<P>- bug in key-decoding removed&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version 1.0&nbsp;&nbsp; ,22-11-2001, Stef Mientki&nbsp;</SPAN></P>
<P>- first release&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Included Files</SPAN></P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS1>Public Procedures</SPAN></P>
<P><SPAN class=RVTS2>procedure scan_keymatrix_ext ( byte out key2 )</SPAN></P>
<P>-- scans the extended keymatrix and decodes multiple keys.</P>
<P>-- every scan only 1 key is returned</P>
<P>-- if a key is pressed during more than 1 scan,</P>
<P>--&nbsp;&nbsp;&nbsp; key = 0 (means no key) is inserted inbetween</P>
<P>-- if multiple keys are pressed, every scan a higher key will be detected.</P>
<P>-- Example: if key 3 and 7 are pressed, succeeding scans will return</P>
<P>-- (remark, here also the zero-key will be inserted)</P>
<P>--&nbsp;&nbsp;&nbsp; 3 , 7 , 0 , 3 , 7 , 0, 3</P>
</BODY></HTML>
