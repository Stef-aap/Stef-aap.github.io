<HTML><HEAD><TITLE>DAC TLV5638</TITLE>
<STYLE type="text/css"><!--
BODY {
  margin: 5px 5px 5px 5px;
  background-color: #E8E8E8;
}

--></STYLE>
<LINK type="text/css" href="rvf.css" rel=STYLESHEET>
<link rel="icon" href="jalccring_small.gif" type="image/gif"></HEAD>
<BODY>

<P><SPAN class=RVTS1>DAC TLV5638</SPAN></P>
<P><SPAN class=RVTS7>This html document is automatically generated by JALcc, from the JAL-sourcefile</SPAN></P>
<P><SPAN class=RVTS7>dac_tlv5638.jal&nbsp;&nbsp; 03-09-2004</SPAN></P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Description&nbsp;</SPAN></P>
<P>Library for the control of the DAC TLV5638 (2 channel 12 bits DAC)&nbsp;</P>
<P>SPI control through both USART and MSSP are supported.&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Example DAC_TLV5638&nbsp;</SPAN></P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;-- this DAC must have CS toggled, so define the CS-pin&nbsp;</P>
<P>&nbsp;&lt;mac&gt; io_pin&nbsp; DAC_TLV5638_CS = pin_E0&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;-- define speed and Vref of the DAC, and the PIC device for SPI-communication&nbsp;</P>
<P>&nbsp;-- define the DA converter settings&nbsp;</P>
<P>&nbsp;const DAC_TLV_5638_fastmode = true&nbsp;</P>
<P>&nbsp;const DAC_TLV_5638_Vref&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- 0 = external&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- 1 = 1.024 Volt&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- 2 = 2.048 Volt&nbsp;</P>
<P>&nbsp;const DAC_TLV5638_spi_usart = false&nbsp; -- false = MSSP is used&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- true&nbsp; = USART is used&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;-- include the DAC library&nbsp;</P>
<P>&nbsp;include DAC_TLV5638&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;-- init DAC and turn it on&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp; DAC_TLV5638_init ( on )&nbsp;&nbsp; -- with power on&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp; -- write both channels to DAC, first fill globalvariables, then call set_AB&nbsp;</P>
<P>&nbsp; DAC_TLV5638_A_MSB = ...&nbsp;</P>
<P>&nbsp; DAC_TLV5638_A_LSB = ...&nbsp;</P>
<P>&nbsp; DAC_TLV5638_B_MSB = ...&nbsp;</P>
<P>&nbsp; DAC_TLV5638_B_LSB = ...&nbsp;</P>
<P>&nbsp; DAC_TLV5638_set_AB&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp; -- turn DAC off&nbsp;</P>
<P>&nbsp; DAC_TLV5638_init ( off )&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>License&nbsp;</SPAN></P>
<P>freeware, under the terms of the GNU GPL&nbsp;</P>
<P>Copyright (C) 2002 Stef Mientki&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS1>Version History</SPAN></P>
<P><A class=RVTS4 href="dac_tlv5638.jal">download&nbsp; dac_tlv5638.jal</A></P>
<P><A class=RVTS4 href="dac_tlv5638_source.html">colorcoded HTML&nbsp; dac_tlv5638_source.html</A></P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.3&nbsp;&nbsp;&nbsp; ,03-09-2004 , Stef Mientki&nbsp;</SPAN></P>
<P>- uses 1 register less&nbsp;</P>
<P>- testroutine added, generates 2 different sawtooths&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.2&nbsp;&nbsp;&nbsp; ,07-07-2004 , Stef Mientki&nbsp;</SPAN></P>
<P>- pin names changed, so macro pin definitions can be used&nbsp;</P>
<P>- CS pin will be set automatically to output&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.1&nbsp;&nbsp;&nbsp; ,10-2-2004 , Stef Mientki&nbsp;</SPAN></P>
<P>- if controled by MSSP, SPI settings are done before every DAC writing,&nbsp;</P>
<P>so these DACs can be used on the same SPI bus with devices that has other&nbsp;</P>
<P>SPI bus settings&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.0&nbsp;&nbsp;&nbsp; ,25-09-2003, Stef Mientki&nbsp;</SPAN></P>
<P>orginal release&nbsp;</P>
<P>tested: only control through MSSP-device&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Included Files</SPAN></P>
<P>12-08-2004&nbsp;&nbsp;&nbsp;<A class=RVTS4 href="rs232_hw.jal">rs232_hw.jal</A>&nbsp;&nbsp;&nbsp; d:\pic-tools\jal\lib\</P>
<P>03-09-2004&nbsp;&nbsp;&nbsp;<A class=RVTS4 href="master_sync_ser_port.jal">master_sync_ser_port.jal</A>&nbsp;&nbsp;&nbsp; d:\pic-tools\jal\lib\</P>
<P>18-10-2002&nbsp;&nbsp;&nbsp;<A class=RVTS4 href="bit_calcs.jal">bit_calcs.jal</A>&nbsp;&nbsp;&nbsp; d:\pic-tools\jal\lib\</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS1>Public Procedures</SPAN></P>
<P><SPAN class=RVTS2>procedure DAC_TLV5638_set_CS</SPAN></P>
<P>-- Sets CS to the DAC,</P>
<P>-- but first sets the SPI-mode in the correct way</P>
<P>-- there are 2 correct ways:</P>
<P>--&nbsp;&nbsp; CKE = CKP = 1</P>
<P>--&nbsp;&nbsp; CKE = CKP = 0</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure DAC_TLV5638_clear_CS</SPAN></P>
<P>-- clear CS to the DAC</P>
<P>-- and restore the old SPI settings</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure DAC_TLV5638_init</SPAN></P>
<P>-- SET DAC control register</P>
<P>-- speed and Vref are set through the constants</P>
<P>--&nbsp;&nbsp;&nbsp; const DAC_TLV_5638_fastmode = true</P>
<P>--&nbsp;&nbsp;&nbsp; const DAC_TLV_5638_Vref&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 2&nbsp;&nbsp;&nbsp;&nbsp; -- 0 = external</P>
<P>--&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- 1 = 1.024 Volt</P>
<P>--&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- 2 = 2.048 Volt</P>
<P>-- power = on / off, (NOTE, different from the final bit transport !!)</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure DAC_TLV5638_set_AB</SPAN></P>
<P>-- SET both DACs with the (new) 12-bit value from globals</P>
<P>--&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DAC_TLV5638_A_MSB , DAC_TLV5638_A_LSB</P>
<P>--&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DAC_TLV5638_B_MSB , DAC_TLV5638_B_LSB</P>
<P>-- (bits 15..12 are ignored)</P>
<P>-- power bit will always be 0 = normal operation</P>
<P>-- speed bit will be set according to the global DAC_TLV_5638_fastmode</P>
<P>--</P>
<P>-- this device only seems to work, when</P>
<P>--&nbsp;&nbsp;&nbsp; * control bytes are sent first</P>
<P>--&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * CS is toggled in between all commands</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure DAC_TLV5638_test</SPAN></P>
<P>-- Test routine, produces 2 different saw-tooths</P>
<P>--&nbsp;&nbsp; output A (pin 4) rising sawtooth</P>
<P>--&nbsp;&nbsp; output B (pin 7) falling sawtooth</P>
</BODY></HTML>
