<HTML><HEAD><TITLE>control of the MSSP-SPI module</TITLE>
<STYLE type="text/css"><!--
BODY {
  margin: 5px 5px 5px 5px;
  background-color: #E8E8E8;
}

--></STYLE>
<LINK type="text/css" href="rvf.css" rel=STYLESHEET>
<link rel="icon" href="jalccring_small.gif" type="image/gif"></HEAD>
<BODY>

<P><SPAN class=RVTS1>control of the MSSP-SPI module</SPAN></P>
<P><SPAN class=RVTS7>This html document is automatically generated by JALcc, from the JAL-sourcefile</SPAN></P>
<P><SPAN class=RVTS7>master_sync_ser_port.jal&nbsp;&nbsp; 05-08-2004</SPAN></P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Description&nbsp;</SPAN></P>
<P>&nbsp;&nbsp;</P>
<P>library to use the MSSP-SPI module limitations:&nbsp;</P>
<P>- only master mode supported&nbsp;</P>
<P>- only SysClock&nbsp; /4&nbsp; /16&nbsp; /64 supported, otherwise error message&nbsp;</P>
<P>- Clock/Data timing always according Texas Instruments / Burr Brown SPI&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Example SPI&nbsp;</SPAN></P>
<P>&nbsp;-- set the SPI-clock frequency, wanted by the user&nbsp;</P>
<P>&nbsp;-- at the moment only System_clock /4&nbsp; /16&nbsp; /64 are supported&nbsp;</P>
<P>&nbsp;-- for other frequencies TMR2 is required&nbsp;</P>
<P>&nbsp;-- User must set the required SPI clock rate before including this library&nbsp;</P>
<P>&nbsp;-- User must select a protocol, to define clock-idle and sampling-edge&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;const SPI_clock = target_clock / 16&nbsp; ;20Mc/16 = 1_250_000&nbsp;</P>
<P>&nbsp;const SPI_mode&nbsp; = 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;0=TI, 1=HP&nbsp;</P>
<P>&nbsp;include master_sync_ser_port&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;include library and initialize&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>License&nbsp;</SPAN></P>
<P>freeware, under the terms of the GNU GPL&nbsp;</P>
<P>Copyright (C) 2002 Stef Mientki&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS1>Version History</SPAN></P>
<P><A class=RVTS4 href="master_sync_ser_port.jal">download&nbsp; master_sync_ser_port.jal</A></P>
<P><A class=RVTS4 href="master_sync_ser_port_source.html">colorcoded HTML&nbsp; master_sync_ser_port_source.html</A></P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.2&nbsp; 17-10-2003&nbsp; Stef Mientki&nbsp;</SPAN></P>
<P>- SMP-bit (in SSPSTAT) was set wrong, I think ??&nbsp;</P>
<P>- const SPI_mode now can select TI, HP modes&nbsp;</P>
<P>- Setting of C3 and C5 direction was not through shadow, fixed !&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.1&nbsp; 1-03-2003&nbsp; Stef Mientki&nbsp;</SPAN></P>
<P>- procedure SPI_mssp_wait_until_ready added&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.0&nbsp; 1-03-2003, Stef Mientki&nbsp;</SPAN></P>
<P>-&nbsp; orginal release&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Included Files</SPAN></P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS1>Public Procedures</SPAN></P>
<P><SPAN class=RVTS2>procedure SPI_enable_mssp</SPAN></P>
<P>-- enable SPI-mssp</P>
<P>-- this routine will also clear IF and set the correct TRIS registers</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure SPI_disable_mssp</SPAN></P>
<P>-- disable SPI-mssp</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure SPI_init_mssp</SPAN></P>
<P>-- init and enable SPI-mssp</P>
<P>-- The following protocols are implemented</P>
<P>-- TI=0 : clock_idle=low, sampling on falling edge</P>
<P>-- HP=1 : clock_idle=high, sampling on rising edge</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure SPI_mssp_wait_until_ready</SPAN></P>
<P>-- wait till last command (read or write) is finished</P>
<P>-- so calling program can release CS</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure SPI_send_mssp ( byte in x )</SPAN></P>
<P>-- Send a SPI byte</P>
<P>-- assumes SPI is enabled, waits till transmission finished</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure SPI_read_mssp ( byte out x )</SPAN></P>
<P>-- Read a SPI byte</P>
<P>-- assumes SPI is enabled</P>
</BODY></HTML>
