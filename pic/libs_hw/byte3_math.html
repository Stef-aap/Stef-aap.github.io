<HTML><HEAD><TITLE>Integer Math (2,3,4,N byte)</TITLE>
<STYLE type="text/css"><!--
BODY {
  margin: 5px 5px 5px 5px;
  background-color: #E8E8E8;
}

--></STYLE>
<LINK type="text/css" href="rvf.css" rel=STYLESHEET>
<link rel="icon" href="jalccring_small.gif" type="image/gif"></HEAD>
<BODY>

<P><SPAN class=RVTS1>Integer Math (2,3,4,N byte)</SPAN></P>
<P><SPAN class=RVTS7>This html document is automatically generated by JALcc, from the JAL-sourcefile</SPAN></P>
<P><SPAN class=RVTS7>byte3_math.jal&nbsp;&nbsp; 13-09-2004</SPAN></P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Description&nbsp;</SPAN></P>
<P>THE DOCUMENTATION OF THIS FILE SHOULD BE IMPROVED (also add exmples) All math routines in this file are 3-byte / 24 bit straight binary math routines&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P>The math routines acts on fixed variables X and Y, definied in this library The use of JALcc macros makes the use of this library very simple&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P>overview of the available routines&nbsp;</P>
<P>byte3_XCHG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y = X&nbsp;&nbsp; ,&nbsp;&nbsp; X = Y&nbsp;</P>
<P>byte3_SHL ( N )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y = Y shl N&nbsp;</P>
<P>byte2_SHL ( N )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y = Y shl N&nbsp;</P>
<P>byte3_SRL ( N , rot)&nbsp;&nbsp; Y = Y shl/rol N&nbsp;</P>
<P>byte3_SRR ( N , rot)&nbsp;&nbsp; Y = Y shr/ror N&nbsp;</P>
<P>byte3_CLIP_NEG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y = 0 if msb set, else Y is left unchanged&nbsp;</P>
<P>byteN_ADD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y = Y + X&nbsp;&nbsp; , X unchanged&nbsp;</P>
<P>byteN_INC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y = Y + 1 ,if Y==0 then X1=0 else X1=1 (X3,X2 unchanged)&nbsp;</P>
<P>byteN_SUB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y = Y - X&nbsp;&nbsp; , X unchanged&nbsp;</P>
<P>byte3_DEC&nbsp; ...&nbsp;</P>
<P>..byte3_LOG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVED TO Byte3_log.jal !! Y = log ( X )&nbsp; , X CHANGED !!&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Example RS232&nbsp;</SPAN></P>
<P>&nbsp;-- define settings&nbsp;</P>
<P>&nbsp;const usart_asynch = true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;true = RS232, false = SPI&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>License&nbsp;</SPAN></P>
<P>freeware, under the terms of the GNU GPL&nbsp;</P>
<P>Copyright (C) 2002 Stef Mientki&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS1>Version History</SPAN></P>
<P><A class=RVTS4 href="byte3_math.jal">download&nbsp; byte3_math.jal</A></P>
<P><A class=RVTS4 href="byte3_math_source.html">colorcoded HTML&nbsp; byte3_math_source.html</A></P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.5&nbsp; 12-09-2004,&nbsp; Stef Mientki&nbsp;</SPAN></P>
<P>- LOG routines are moved to Byte3_log.jal&nbsp;</P>
<P>- SHL 2 added&nbsp;</P>
<P>- SHR 2,3 added&nbsp;</P>
<P>- SHLX 2,3 added&nbsp;</P>
<P>- SHRX 2,3 added&nbsp;</P>
<P>- "pragma keep page" added to all assembler routines&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.4&nbsp; 16-10-2003,&nbsp; Stef Mientki&nbsp;</SPAN></P>
<P>- SRL was totally wrong, bug fixed&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.3&nbsp; 15-08-2002,&nbsp; Stef Mientki&nbsp;</SPAN></P>
<P>- INC 2,3,4,N bytes added&nbsp;</P>
<P>- DEC added ??&nbsp;</P>
<P>- CMP 2,3,4,N bytes compare&nbsp;</P>
<P>- ADD 2,3,4,N bytes compare&nbsp;</P>
<P>- SUB 2,3,4,N bytes compare&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.2&nbsp; 05-03-2002,&nbsp; Stef Mientki&nbsp;</SPAN></P>
<P>- SHL replaced by SRL&nbsp;</P>
<P>- SRR added&nbsp;</P>
<P>- CLIP_NEG added&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.1&nbsp; 27-02-2002,&nbsp; Stef Mientki&nbsp;</SPAN></P>
<P>- LOG_ACCURACY must be definied outside this library&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.0&nbsp; 26-02-2002, Stef Mientki&nbsp;</SPAN></P>
<P>- orginal release&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Included Files</SPAN></P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS1>Public Procedures</SPAN></P>
<P><SPAN class=RVTS2>procedure byte3_XCHG</SPAN></P>
<P>-- 24 bit Exchange routine</P>
<P>-- Y = X</P>
<P>-- X = Y</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte3_CLIP_NEG</SPAN></P>
<P>-- 24 bit negative clipping</P>
<P>-- if Y negative (msb is set) Y = 0 else Y is left unchanged</P>
<P>-- X is left unchanged</P>
<P>--</P>
<P>-- in fact this is not a straight binary routine,</P>
<P>-- it'll clip negative (offset binary) values to zero</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte2_SHL ( byte in N )</SPAN></P>
<P>-- 16 bit SHL routine</P>
<P>-- Y = Y shl N</P>
<P>-- X is left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte3_SHL ( byte in N )</SPAN></P>
<P>-- 24 bit SHL routine</P>
<P>-- Y = Y shl N</P>
<P>-- X is left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte2_SHLX ( byte in N )</SPAN></P>
<P>-- 16 bit SHL routine in X</P>
<P>-- X = X shl N</P>
<P>-- Y is left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte3_SHLX ( byte in N )</SPAN></P>
<P>-- 24 bit SHL routine in X</P>
<P>-- X = X shl N</P>
<P>-- Y is left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte3_SRL ( byte in N = 1 , bit in rotate = false )</SPAN></P>
<P>-- 24 bit shift/rotate LEFT routine</P>
<P>-- if shift (default)&nbsp; then Y = Y shl N</P>
<P>-- if rotate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; then Y = Y rol N</P>
<P>-- X is left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte2_SHR ( byte in N = 1 )</SPAN></P>
<P>-- 16 bit shift Right routine</P>
<P>-- Y = Y shr N</P>
<P>-- X is left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte3_SHR ( byte in N = 1 )</SPAN></P>
<P>-- 24 bit shift Right routine</P>
<P>-- Y = Y shr N</P>
<P>-- X is left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte2_SHRX ( byte in N = 1 )</SPAN></P>
<P>-- 16 bit shift Right routine in X</P>
<P>-- X = X shr N</P>
<P>-- Y is left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte3_SHRX ( byte in N = 1 )</SPAN></P>
<P>-- 24 bit shift Right routine in X</P>
<P>-- X = X shr N</P>
<P>-- Y is left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte3_SRR ( byte in N = 1 , bit in rotate = false )</SPAN></P>
<P>-- 24 bit shift/rotate Right routine</P>
<P>-- if shift (default)&nbsp; then Y = Y shr N</P>
<P>-- if rotate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; then Y = Y ror N</P>
<P>-- X is left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byteN_ADD</SPAN></P>
<P>-- N,2,3,4 byte ADD routine</P>
<P>-- Y = Y + X</P>
<P>-- X is left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte2_ADD</SPAN></P>
<P>procedure byteN_ADD is</P>
<P>&nbsp; assembler</P>
<P>&nbsp; pragma keep page</P>
<P>&nbsp; local carry_y2, carry_y3, carry_y4, start</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp; -- this method can easily be expanded to more bytes</P>
<P>&nbsp; carry_y2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;aggregate the Carry through all the bytes</P>
<P>&nbsp;&nbsp;&nbsp; incfsz&nbsp;&nbsp; y2,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; carry_y3:</P>
<P>&nbsp;&nbsp;&nbsp; incfsz&nbsp;&nbsp; y3,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; carry_y4:</P>
<P>&nbsp;&nbsp;&nbsp; incf&nbsp;&nbsp;&nbsp;&nbsp; y4,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp; start:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movf&nbsp;&nbsp;&nbsp;&nbsp; x1,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; W = X1</P>
<P>&nbsp;&nbsp;&nbsp; addwf&nbsp;&nbsp;&nbsp; y1,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; Y1 = Y1 + X1</P>
<P>&nbsp;&nbsp;&nbsp; btfsc&nbsp;&nbsp;&nbsp; status,C&nbsp;&nbsp;&nbsp; ; skip if no Carry</P>
<P>&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp; carry_y2&nbsp;&nbsp;&nbsp; ; add Carry</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp; movf&nbsp;&nbsp;&nbsp;&nbsp; x2,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; W = X2</P>
<P>&nbsp;&nbsp;&nbsp; addwf&nbsp;&nbsp;&nbsp; y2,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; Y2 = Y2 + X2</P>
<P>&nbsp;&nbsp;&nbsp; btfsc&nbsp;&nbsp;&nbsp; status,C&nbsp;&nbsp;&nbsp; ; skip if no Carry</P>
<P>&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp; carry_y3&nbsp;&nbsp;&nbsp; ; add Carry</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp; movf&nbsp;&nbsp;&nbsp;&nbsp; x3,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; W = X3</P>
<P>&nbsp;&nbsp;&nbsp; addwf&nbsp;&nbsp;&nbsp; y3,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; Y3 = Y3 + X3</P>
<P>&nbsp;&nbsp;&nbsp; btfsc&nbsp;&nbsp;&nbsp; status,C&nbsp;&nbsp;&nbsp; ; skip if no Carry</P>
<P>&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp; carry_y4&nbsp;&nbsp;&nbsp; ; add Carry</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp; movf&nbsp;&nbsp;&nbsp;&nbsp; x4,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; W = X4</P>
<P>&nbsp;&nbsp;&nbsp; addwf&nbsp;&nbsp;&nbsp; y4,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; Y4 = Y4 + X4</P>
<P>&nbsp; end assembler</P>
<P>end procedure</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte3_ADD</SPAN></P>
<P>procedure byte2_ADD is</P>
<P>&nbsp; byteN_add</P>
<P>end procedure</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte4_ADD</SPAN></P>
<P>procedure byte3_ADD is</P>
<P>&nbsp; byteN_add</P>
<P>end procedure</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byteN_cmp&nbsp; (byte in N)</SPAN></P>
<P>-- N,2,3,4 bytes CMP routine</P>
<P>-- if X=Y then Z1=0 else Z1=1</P>
<P>-- X, Y, Z4,Z3,X2 are left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte2_CMP</SPAN></P>
<P>procedure byteN_cmp&nbsp; (byte in N) is</P>
<P>&nbsp; assembler</P>
<P>&nbsp; pragma keep page</P>
<P>&nbsp; local byte4, byte3, byte2, byte1, equal, not_equal, finish</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp; decf&nbsp;&nbsp;&nbsp;&nbsp; N,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; btfsc&nbsp;&nbsp;&nbsp; Z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; byte1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;if ZERO (N=1)</P>
<P>&nbsp;&nbsp;&nbsp; decf&nbsp;&nbsp;&nbsp;&nbsp; N,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; btfsc&nbsp;&nbsp;&nbsp; Z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; byte2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;if ZERO (N=2)</P>
<P>&nbsp;&nbsp;&nbsp; decf&nbsp;&nbsp;&nbsp;&nbsp; N,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; btfsc&nbsp;&nbsp;&nbsp; Z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; byte3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;if ZERO (N=3)</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp; byte4:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movf&nbsp;&nbsp;&nbsp;&nbsp; x4,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; subwf&nbsp;&nbsp;&nbsp; y4,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; btfss&nbsp;&nbsp;&nbsp; Z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; not_equal&nbsp;&nbsp; ;</P>
<P>&nbsp; byte3:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movf&nbsp;&nbsp;&nbsp;&nbsp; x3,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; subwf&nbsp;&nbsp;&nbsp; y3,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; btfss&nbsp;&nbsp;&nbsp; Z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; not_equal&nbsp;&nbsp; ;</P>
<P>&nbsp; byte2:</P>
<P>&nbsp;&nbsp;&nbsp; movf&nbsp;&nbsp;&nbsp;&nbsp; x2,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; subwf&nbsp;&nbsp;&nbsp; y2,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; btfss&nbsp;&nbsp;&nbsp; Z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; not_equal&nbsp;&nbsp; ;</P>
<P>&nbsp; byte1:</P>
<P>&nbsp;&nbsp;&nbsp; movf&nbsp;&nbsp;&nbsp;&nbsp; x1,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; subwf&nbsp;&nbsp;&nbsp; y1,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; btfss&nbsp;&nbsp;&nbsp; Z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; not_equal&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp; equal:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movlw&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; finish&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; not_equal:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movlw&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; finish:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movwf&nbsp;&nbsp;&nbsp; z1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; end assembler</P>
<P>end procedure</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte3_CMP</SPAN></P>
<P>procedure byte2_CMP is</P>
<P>&nbsp; byteN_CMP (2)</P>
<P>end procedure</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte4_CMP</SPAN></P>
<P>procedure byte3_CMP is</P>
<P>&nbsp; byteN_CMP (3)</P>
<P>end procedure</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>function byteN_fcmp (byte in N) return bit</SPAN></P>
<P>procedure byte4_CMP is</P>
<P>&nbsp; byteN_CMP (4)</P>
<P>end procedure</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte2_INC</SPAN></P>
<P>-- N,2,3,4 bytes INC routine</P>
<P>-- Y = Y + 1</P>
<P>-- if Y=0 then Z1=0 else Z1=1</P>
<P>-- X, Z4,Z3,X2 are left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte3_INC</SPAN></P>
<P>procedure byte2_INC is</P>
<P>&nbsp; assembler</P>
<P>&nbsp; pragma keep page</P>
<P>&nbsp; local non_zero, finish</P>
<P>&nbsp;&nbsp;&nbsp; incfsz&nbsp;&nbsp; y1,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; non_zero&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; incfsz&nbsp;&nbsp; y2,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; non_zero&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movlw&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; finish&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; non_zero:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movlw&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; finish:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movwf&nbsp;&nbsp;&nbsp; z1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; end assembler</P>
<P>end procedure</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte4_INC</SPAN></P>
<P>procedure byte3_INC is</P>
<P>&nbsp; assembler</P>
<P>&nbsp; pragma keep page</P>
<P>&nbsp; local non_zero, finish</P>
<P>&nbsp;&nbsp;&nbsp; incfsz&nbsp;&nbsp; y1,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; non_zero&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; incfsz&nbsp;&nbsp; y2,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; non_zero&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; incfsz&nbsp;&nbsp; y3,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; non_zero&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movlw&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; finish&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; non_zero:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movlw&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; finish:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movwf&nbsp;&nbsp;&nbsp; z1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; end assembler</P>
<P>end procedure</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byteN_INC (byte in N)</SPAN></P>
<P>procedure byte4_INC is</P>
<P>&nbsp; assembler</P>
<P>&nbsp; pragma keep page</P>
<P>&nbsp; local non_zero, finish</P>
<P>&nbsp;&nbsp;&nbsp; incfsz&nbsp;&nbsp; y1,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; non_zero&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; incfsz&nbsp;&nbsp; y2,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; non_zero&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; incfsz&nbsp;&nbsp; y3,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; non_zero&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; incfsz&nbsp;&nbsp; y4,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; non_zero&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movlw&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; finish&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; non_zero:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movlw&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; finish:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movwf&nbsp;&nbsp;&nbsp; z1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; end assembler</P>
<P>end procedure</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte3_MUL</SPAN></P>
<P>-- 24 bit multiply routine</P>
<P>-- Y = Y * X</P>
<P>-- X is CHANGED !!</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byteN_SUB</SPAN></P>
<P>-- N,2,3,4 byte SUB routine</P>
<P>-- Y = Y - X</P>
<P>-- X is left unchanged</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte2_SUB</SPAN></P>
<P>procedure byteN_SUB is</P>
<P>&nbsp; assembler</P>
<P>&nbsp; pragma keep page</P>
<P>&nbsp; local borrow_y2, borrow_y3, borrow_y4, start</P>
<P>&nbsp; page start</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp; goto&nbsp;&nbsp;&nbsp;&nbsp; start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp; -- this method can easily be expanded to more bytes</P>
<P>&nbsp; borrow_y2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;aggregate the Borrow through all the bytes</P>
<P>&nbsp;&nbsp;&nbsp; decf&nbsp;&nbsp;&nbsp;&nbsp; y2,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; comf&nbsp;&nbsp;&nbsp;&nbsp; y2,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; btfss&nbsp;&nbsp;&nbsp; status,Z&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; borrow_y3:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;aggregate the Borrow through all the bytes</P>
<P>&nbsp;&nbsp;&nbsp; decf&nbsp;&nbsp;&nbsp;&nbsp; y3,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; comf&nbsp;&nbsp;&nbsp;&nbsp; y3,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; btfss&nbsp;&nbsp;&nbsp; status,Z&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp; borrow_y4:</P>
<P>&nbsp;&nbsp;&nbsp; decf&nbsp;&nbsp;&nbsp;&nbsp; y4,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp; start:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</P>
<P>&nbsp;&nbsp;&nbsp; movf&nbsp;&nbsp;&nbsp;&nbsp; x1,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; W = X1</P>
<P>&nbsp;&nbsp;&nbsp; subwf&nbsp;&nbsp;&nbsp; y1,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; Y1 = Y1 - X1</P>
<P>&nbsp;&nbsp;&nbsp; btfss&nbsp;&nbsp;&nbsp; status,C&nbsp;&nbsp;&nbsp; ; skip if no Borrow</P>
<P>&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp; borrow_y2&nbsp;&nbsp; ; subtract Borrow</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp; movf&nbsp;&nbsp;&nbsp;&nbsp; x2,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; W = X2</P>
<P>&nbsp;&nbsp;&nbsp; subwf&nbsp;&nbsp;&nbsp; y2,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; Y2 = Y2 - X2</P>
<P>&nbsp;&nbsp;&nbsp; btfss&nbsp;&nbsp;&nbsp; status,C&nbsp;&nbsp;&nbsp; ; skip if no Borrow</P>
<P>&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp; borrow_y3&nbsp;&nbsp; ; subtract Borrow</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp; movf&nbsp;&nbsp;&nbsp;&nbsp; x3,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; W = X3</P>
<P>&nbsp;&nbsp;&nbsp; subwf&nbsp;&nbsp;&nbsp; y3,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; Y3 = Y3 - X3</P>
<P>&nbsp;&nbsp;&nbsp; btfss&nbsp;&nbsp;&nbsp; status,C&nbsp;&nbsp;&nbsp; ; skip if no Borrow</P>
<P>&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp; borrow_y4&nbsp;&nbsp; ; subtract Borrow</P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp; movf&nbsp;&nbsp;&nbsp;&nbsp; x4,w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; W = X4</P>
<P>&nbsp;&nbsp;&nbsp; subwf&nbsp;&nbsp;&nbsp; y4,f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; Y4 = Y4 - X4</P>
<P>&nbsp; end assembler</P>
<P>end procedure</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte3_SUB</SPAN></P>
<P>procedure byte2_SUB is</P>
<P>&nbsp; byteN_SUB</P>
<P>end procedure</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte4_SUB</SPAN></P>
<P>procedure byte3_SUB is</P>
<P>&nbsp; byteN_SUB</P>
<P>end procedure</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure byte3_DEC</SPAN></P>
<P>-- 24 bit DEC routine</P>
<P>-- Y = Y - 1</P>
<P>-- X = 1</P>
</BODY></HTML>
