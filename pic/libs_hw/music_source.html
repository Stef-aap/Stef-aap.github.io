<html>
<head>
<title>JALcc SourceCode exporting of music_source.html</title>
</head>
<!-- Generated by SynEdit HTML exporter -->
<body text="#000000" bgcolor="#FFFFFF">
<pre>
<code><font  size=3 face="Courier New"><font color="#000080"><A href="music.jal">download&nbsp;music.jal</A>
</font><font color="#808080"><i>-- -----------------------------------------------------------------------------
-- demo program to shows the use of sound and music routines
-- Author : Stef Mientki
-- Version: 1.0  11-04-2002  orginal release
-- -----------------------------------------------------------------------------

</i></font><font color="#FF00FF">include 16F628_defs
include delay_20mc
include play_music1_ins


</font><font color="#000080">pin_a0_direction <b>= </b></font><font color="#FF0000">output
</font><b>var byte </b><font color="#000080">demo <b>= </b></font><font color="#FF0000">0
</font><font color="#000080">sound_pause <b>= </b></font><font color="#FF0000">0

</font><b>forever loop
    </b><font color="#000080">play_music_mode_interrupt <b>= </b></font><font color="#FF0000">false
    </font><font color="#000080">play_song
        pin_a0 <b>= ! </b>pin_a0        </font><font color="#808080"><i>-- show user song is playing

;for 10 loop
;    play_tone_and_wait ( 40 , 255 )
;end loop

;    play_music_mode_interrupt = true
;    play_song
;    while song_playing loop
;        pin_a0 = ! pin_a0        -- show user song is playing
;    end loop
    </i></font><font color="#000080">delay_100ms <b>(</b></font><font color="#FF0000">50</font><font color="#000080"><b>)
</b></font><b>end loop
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
-- MAIN PROGRAM LOOP
-- -----------------------------------------------------------------------------
</i></font><b>forever loop

  </b><font color="#808080"><i>-- DEMO-0 plays a song in non interrupted mode
  </i></font><b>if </b><font color="#000080">demo <b>== </b></font><font color="#FF0000">0 </font><b>then
    </b><font color="#000080">play_music_mode_interrupt <b>= </b></font><font color="#FF0000">false
    </font><font color="#000080">play_song


  </font><font color="#808080"><i>-- DEMO-1 plays a song in interrupted mode
  -- while playing the song, a LED on RA0 is toggled
  </i></font><b>elsif </b><font color="#000080">demo <b>== </b></font><font color="#FF0000">1 </font><b>then
    </b><font color="#000080">play_music_mode_interrupt <b>= </b></font><font color="#FF0000">true
    </font><font color="#000080">play_song
    </font><b>while </b><font color="#000080">song_playing </font><b>loop
        </b><font color="#000080">pin_a0 <b>= ! </b>pin_a0        </font><font color="#808080"><i>-- show user song is playing
    </i></font><b>end loop


  </b><font color="#808080"><i>-- DEMO-2 plays a number of songs in non interrupted mode
  -- for songs which can be divided into couplets,
  -- non-interrupted mode is somewhat more easier
  </i></font><b>elsif </b><font color="#000080">demo <b>== </b></font><font color="#FF0000">2 </font><b>then
    </b><font color="#000080">play_music_mode_interrupt <b>= </b></font><font color="#FF0000">false
    </font><b>for </b><font color="#FF0000">2 </font><b>loop </b><font color="#000080">play_tune <b>( </b></font><font color="#FF0000">0 </font><font color="#000080"><b>) </b></font><b>end loop
    </b><font color="#000080">play_tune <b>( </b></font><font color="#FF0000">1 </font><font color="#000080"><b>)
    </b></font><b>for </b><font color="#FF0000">2 </font><b>loop </b><font color="#000080">play_tune <b>( </b></font><font color="#FF0000">2 </font><font color="#000080"><b>) </b></font><b>end loop
    </b><font color="#000080">play_tune <b>( </b></font><font color="#FF0000">3 </font><font color="#000080"><b>)

  </b></font><font color="#808080"><i>-- DEMO-3 plays 1 fixed tone and waits till it finished
  </i></font><b>else
    </b><font color="#000080">play_tone_and_wait <b>( </b></font><font color="#FF0000">40 </font><font color="#000080"><b>, </b></font><font color="#FF0000">100 </font><font color="#000080"><b>)

  </b></font><b>end if

  </b><font color="#808080"><i>-- goto the next demo, after 3 seconds
  </i></font><font color="#000080">demo <b>= </b>demo <b>+ </b></font><font color="#FF0000">1
  </font><font color="#000080">demo <b>= </b>demo <b>&amp; </b></font><font color="#FF0000">3
  </font><font color="#000080">delay_100ms <b>( </b></font><font color="#FF0000">30 </font><font color="#000080"><b>)
  
</b></font><b>end loop
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------

;;;;;&lt;;mac&gt; interrupt_prio _TMR0_interrupt 20  ;increase priority
;;;;;&lt;;/mac&gt;
;;;;;&lt;;mac&gt; interrupt_main                     ;generate total interrupt routine
</i></font><b>procedure </b><font color="#000080">xzxzxzxz </font><b>is
</b><font color="#800080"><i>pragma </i></font><font color="#000080">interrupt
  </font><b>if </b><font color="#000080">t0if </font><b>then 
     </b><font color="#000080">_tmr0_interrupt   </font><font color="#808080"><i>;priority=20
  </i></font><b>end if
end procedure
</b><font color="#808080"><i>;;;;;&lt;;/mac&gt;


-- these functions have to be declared here, to prevent compiler errors,
-- due to the fact these routines are only called from the ISR
-- if the routine is not called somewhere else,
-- compiler error NULL pointer occures
;_get_next_tone_and_duration

</i></font></font>
</code></pre>
</body>
</html>
