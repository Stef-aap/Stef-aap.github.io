<HTML><HEAD><TITLE>Software RS232 library</TITLE>
<STYLE type="text/css"><!--
BODY {
  margin: 5px 5px 5px 5px;
  background-color: #E8E8E8;
}

--></STYLE>
<LINK type="text/css" href="rvf.css" rel=STYLESHEET>
<link rel="icon" href="jalccring_small.gif" type="image/gif"></HEAD>
<BODY>

<P><SPAN class=RVTS1>Software RS232 library</SPAN></P>
<P><SPAN class=RVTS7>This html document is automatically generated by JALcc, from the JAL-sourcefile</SPAN></P>
<P><SPAN class=RVTS7>rs232_sw.jal&nbsp;&nbsp; 04-08-2004</SPAN></P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Description&nbsp;</SPAN></P>
<P>Library supports software RS232 send and receive procedure on any IO-pin. Both the inverted and non-inverted routines are available, so it should fit any hardware. Baudrate can be set between 110 and 230_400 (for 20 Mhz Xtal) for lower Xtal frequencies the maximum baudrate will be equally lower. Baudrates are optimized, so even the high baudrates shouldn't be a problem (my standard = 115_200 Baud, which has never given me any problems).&nbsp;</P>
<P>Interrupts should be disabled during transmissions.&nbsp;</P>
<P>Transmission parameters are 8 databits, 2 stopbits, no parity, no handshake.&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Example software RS232&nbsp;</SPAN></P>
<P>&nbsp;-- define transmission settings&nbsp;</P>
<P>&nbsp;const asynch_baudrate_sw = 115_200&nbsp;</P>
<P>&nbsp;const asynch_invert_sw&nbsp;&nbsp; = true&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;-- define the software transmit/receive pin&nbsp;</P>
<P>&nbsp;&lt;mac&gt; io_pin&nbsp; asynch_sw_out = pin_b7&nbsp;</P>
<P>&nbsp;&lt;mac&gt; io_pin&nbsp; asynch_sw_in&nbsp; = pin_b6&nbsp;</P>
<P>&nbsp;include rs232_sw&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;-- start initializations if functions are used&nbsp;</P>
<P>&nbsp;asynch_sw_init_transmit&nbsp;</P>
<P>&nbsp;asynch_sw_init_receive&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;var byte xx&nbsp;</P>
<P>&nbsp;forever loop&nbsp;</P>
<P>&nbsp;&nbsp; -- wait till character received, echo inverted&nbsp;</P>
<P>&nbsp;&nbsp; asynch_read_sw (xx)&nbsp;</P>
<P>&nbsp;&nbsp; asynch_send_sw ( ! xx)&nbsp;</P>
<P>&nbsp;&nbsp; ... do other things&nbsp;</P>
<P>&nbsp;end loop&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>License&nbsp;</SPAN></P>
<P>freeware, under the terms of the GNU GPL&nbsp;</P>
<P>Copyright (C) 2002 Stef Mientki&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS1>Version History</SPAN></P>
<P><A class=RVTS4 href="rs232_sw.jal">download&nbsp; rs232_sw.jal</A></P>
<P><A class=RVTS4 href="rs232_sw_source.html">colorcoded HTML&nbsp; rs232_sw_source.html</A></P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 2.0 future wishes&nbsp;</SPAN></P>
<P>- timeout in receive routine&nbsp;</P>
<P>- receive routine as boolean function, true=new character, false=timeout&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.2&nbsp;&nbsp;&nbsp;&nbsp; ,03-11-2002 ,Stef Mientki&nbsp;</SPAN></P>
<P>- inverted version of receive and transmit added&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.1&nbsp;&nbsp;&nbsp;&nbsp; ,28-02-2002 ,Stef Mientki&nbsp;</SPAN></P>
<P>- naming of registers changed to SM-notation&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.0&nbsp;&nbsp;&nbsp;&nbsp; ,03-01-2002 ,Stef Mientki&nbsp;</SPAN></P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Included Files</SPAN></P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS1>Public Procedures</SPAN></P>
<P><SPAN class=RVTS2>procedure asynch_send_sw (byte in x)</SPAN></P>
<P>-- Sends (by software) the byte "X" to the RS232 port</P>
<P>-- Baudrate can be set between 110 and 230_400 for a 20 MHz Xtal</P>
<P>-- If required baudrate is too low or too high a pragma error is generated.</P>
<P>-- On entering this routine, the interrupts will be disabled and left disabled.</P>
<P>--</P>
<P>-- I couldn't think of an elegant way to realize both inverted and non-inverting,</P>
<P>-- so I just copied the code inside and used a compiler if-directive</P>
<P>-- The 2 stopbits can easily adapted by chnaging BITCNT</P>
<P>-- 230_400 not yet tested, theoretical there's 1 instruction to much,</P>
<P>-- but I can't figure out how to save 1 (in a simple way).</P>
<P>-- Output to the port is nicely done through the shadow register.</P>
<P>--</P>
<P>-- The first bytes transmitted are rubish, but that can well be caused by the very</P>
<P>-- simple hardware used.</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure asynch_receive_sw ( byte out x )</SPAN></P>
<P>-- waits untill a character is received.</P>
<P>-- Interrupts should be disabled prior to entering this routine.</P>
<P>-- Also here the code is doubled (inverting and non-inverting)</P>
<P>-- and selection is done by a compiler-directive.</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure asynch_sw_init_transmit</SPAN></P>
<P>-- intialisation of value and direction of output pin</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure asynch_sw_init_receive</SPAN></P>
<P>-- intialisation of direction of input pin</P>
</BODY></HTML>
