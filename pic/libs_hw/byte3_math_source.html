<html>
<head>
<title>JALcc SourceCode exporting of byte3_math_source.html</title>
</head>
<!-- Generated by SynEdit HTML exporter -->
<body text="#000000" bgcolor="#FFFFFF">
<pre>
<code><font  size=3 face="Courier New"><font color="#000080"><A href="byte3_math.jal">download&nbsp;byte3_math.jal</A>
</font><font color="#808080"><i>-- -----------------------------------------------------------------------------
-- &lt;title Integer Math (2,3,4,N byte)
-- &lt;License
-- freeware, under the terms of the GNU GPL
--  Copyright (C) 2002 Stef Mientki
-- -----------------------------------------------------------------------------
-- &lt;Description
-- THE DOCUMENTATION OF THIS FILE SHOULD BE IMPROVED (also add exmples)
-- All math routines in this file are 3-byte / 24 bit straight binary math routines
--
-- The math routines acts on fixed variables X and Y, definied in this library
-- The use of JALcc macros makes the use of this library very simple
--
-- overview of the available routines
--  byte3_XCHG             Y = X   ,   X = Y
--  byte3_SHL ( N )        Y = Y shl N
--  byte2_SHL ( N )        Y = Y shl N
--  byte3_SRL ( N , rot)   Y = Y shl/rol N
--  byte3_SRR ( N , rot)   Y = Y shr/ror N
--  byte3_CLIP_NEG         Y = 0 if msb set, else Y is left unchanged
--  byteN_ADD              Y = Y + X   , X unchanged
--  byteN_INC              Y = Y + 1 ,if Y==0 then X1=0 else X1=1 (X3,X2 unchanged)
--  byteN_SUB              Y = Y - X   , X unchanged
--  byte3_DEC  ...
--  ..byte3_LOG              MOVED TO Byte3_log.jal !! Y = log ( X )  , X CHANGED !!
--
-- &lt;Version: 1.5  12-09-2004,  Stef Mientki
--   - LOG routines are moved to Byte3_log.jal
--   - SHL 2 added
--   - SHR 2,3 added
--   - SHLX 2,3 added
--   - SHRX 2,3 added
--   - &quot;pragma keep page&quot; added to all assembler routines
--
-- &lt;Version: 1.4  16-10-2003,  Stef Mientki
--   - SRL was totally wrong, bug fixed
--
-- &lt;Version: 1.3  15-08-2002,  Stef Mientki
--   - INC 2,3,4,N bytes added
--   - DEC added ??
--   - CMP 2,3,4,N bytes compare
--   - ADD 2,3,4,N bytes compare
--   - SUB 2,3,4,N bytes compare
--
-- &lt;Version: 1.2  05-03-2002,  Stef Mientki
--   - SHL replaced by SRL
--   - SRR added
--   - CLIP_NEG added
--
-- &lt;Version: 1.1  27-02-2002,  Stef Mientki
--   - LOG_ACCURACY must be definied outside this library
--
-- &lt;Version: 1.0  26-02-2002, Stef Mientki
--   - orginal release
-- -----------------------------------------------------------------------------
-- -----------------------------------------------------------------------------



-- -----------------------------------------------------------------------------
-- &lt;Example RS232
; -- define settings
; const usart_asynch = true      ;true = RS232, false = SPI
-- -----------------------------------------------------------------------------


-- &lt;code

-- -----------------------------------------------------------------------------
-- Definitions of the global vars
-- X = 24 bit = X3 .. X2 .. X1
-- Y = 24 bit
</i></font><b>var byte </b><font color="#000080">x4<b>,</b>x3<b>,</b>x2<b>,</b>x1
</font><b>var byte </b><font color="#000080">y4<b>,</b>y3<b>,</b>y2<b>,</b>y1
</font><b>var byte </b><font color="#000080">z4<b>,</b>z3<b>,</b>z2<b>,</b>z1
</font><font color="#808080"><i>-- -----------------------------------------------------------------------------



-- -----------------------------------------------------------------------------
-- 24 bit Exchange routine
-- Y = X
-- X = Y
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_XCHG </font><b>is
var byte </b><font color="#000080">x
  x <b>= </b>X1
  X1 <b>= </b>Y1
  Y1 <b>= </b>x
  x <b>= </b>X2
  X2 <b>= </b>Y2
  Y2 <b>= </b>x
  x <b>= </b>X3
  X3 <b>= </b>Y3
  Y3 <b>= </b>x
</font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------



-- -----------------------------------------------------------------------------
-- 24 bit negative clipping
-- if Y negative (msb is set) Y = 0 else Y is left unchanged
-- X is left unchanged
--
-- in fact this is not a straight binary routine,
-- it'll clip negative (offset binary) values to zero
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_CLIP_NEG </font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">finish
    btfss    y3<b>,</b></font><font color="#FF0000">7        </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     finish      </font><font color="#808080"><i>;
    </i></font><font color="#800080"><i>movlw    </i></font><font color="#FF0000">0           </font><font color="#808080"><i>;
    </i></font><font color="#000080">movwf    y3          </font><font color="#808080"><i>;
    </i></font><font color="#000080">movwf    y2          </font><font color="#808080"><i>;
    </i></font><font color="#000080">movwf    y1          </font><font color="#808080"><i>;
  </i></font><font color="#000080">finish<b>:                </b></font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------



-- -----------------------------------------------------------------------------
-- 16 bit SHL routine
-- Y = Y shl N
-- X is left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte2_SHL <b>( </b></font><b>byte in </b><font color="#000080">N <b>) </b></font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">next
  next<b>:                  </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">bcf      status<b>,</b>C    </font><font color="#808080"><i>;clear Carry
    </i></font><font color="#000080">rlf      y1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rlf      y2<b>,</b>f        </font><font color="#808080"><i>;

    </i></font><font color="#000080">decfsz   N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     next        </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------


-- -----------------------------------------------------------------------------
-- 24 bit SHL routine
-- Y = Y shl N
-- X is left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_SHL <b>( </b></font><b>byte in </b><font color="#000080">N <b>) </b></font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">next
  next<b>:                  </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">bcf      status<b>,</b>C    </font><font color="#808080"><i>;clear Carry
    </i></font><font color="#000080">rlf      y1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rlf      y2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rlf      y3<b>,</b>f        </font><font color="#808080"><i>;

    </i></font><font color="#000080">decfsz   N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     next        </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------


-- -----------------------------------------------------------------------------
-- 16 bit SHL routine in X
-- X = X shl N
-- Y is left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte2_SHLX <b>( </b></font><b>byte in </b><font color="#000080">N <b>) </b></font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">next
  next<b>:                  </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">bcf      status<b>,</b>C    </font><font color="#808080"><i>;clear Carry
    </i></font><font color="#000080">rlf      x1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rlf      x2<b>,</b>f        </font><font color="#808080"><i>;

    </i></font><font color="#000080">decfsz   N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     next        </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------


-- -----------------------------------------------------------------------------
-- 24 bit SHL routine in X
-- X = X shl N
-- Y is left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_SHLX <b>( </b></font><b>byte in </b><font color="#000080">N <b>) </b></font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">next
  next<b>:                  </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">bcf      status<b>,</b>C    </font><font color="#808080"><i>;clear Carry
    </i></font><font color="#000080">rlf      x1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rlf      x2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rlf      x3<b>,</b>f        </font><font color="#808080"><i>;

    </i></font><font color="#000080">decfsz   N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     next        </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------




-- -----------------------------------------------------------------------------
-- 24 bit shift/rotate LEFT routine
-- if shift (default)  then Y = Y shl N
-- if rotate           then Y = Y rol N
-- X is left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_SRL <b>( </b></font><b>byte in </b><font color="#000080">N <b>= </b></font><font color="#FF0000">1 </font><font color="#000080"><b>, </b></font><b>bit in </b><font color="#000080">rotate <b>= </b></font><font color="#FF0000">false </font><font color="#000080"><b>) </b></font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">next<b>, </b>no_rotate
  next<b>:                  </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">bcf      status<b>,</b>C    </font><font color="#808080"><i>;clear Carry
    </i></font><font color="#000080">btfss    rotate      </font><font color="#808080"><i>;test if rotate
    </i></font><font color="#000080">goto     no_rotate   </font><font color="#808080"><i>;if shift rather than rotate
    </i></font><font color="#000080">btfsc    y3<b>,</b></font><font color="#FF0000">7        </font><font color="#808080"><i>;if rotate, test lsb
    </i></font><font color="#000080">bsf      status<b>,</b>C    </font><font color="#808080"><i>;set Carry according to lsb
  </i></font><font color="#000080">no_rotate<b>:             </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">rlf      y1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rlf      y2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rlf      y3<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">decfsz   N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     next        </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------


-- -----------------------------------------------------------------------------
-- 16 bit shift Right routine
-- Y = Y shr N
-- X is left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte2_SHR <b>( </b></font><b>byte in </b><font color="#000080">N <b>= </b></font><font color="#FF0000">1 </font><font color="#000080"><b>) </b></font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">next
  next<b>:                  </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">bcf      status<b>,</b>C    </font><font color="#808080"><i>;clear Carry
    </i></font><font color="#000080">rrf      y2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rrf      y1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">decfsz   N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     next        </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------


-- -----------------------------------------------------------------------------
-- 24 bit shift Right routine
-- Y = Y shr N
-- X is left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_SHR <b>( </b></font><b>byte in </b><font color="#000080">N <b>= </b></font><font color="#FF0000">1 </font><font color="#000080"><b>) </b></font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">next
  next<b>:                  </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">bcf      status<b>,</b>C    </font><font color="#808080"><i>;clear Carry
    </i></font><font color="#000080">rrf      y3<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rrf      y2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rrf      y1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">decfsz   N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     next        </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------


-- -----------------------------------------------------------------------------
-- 16 bit shift Right routine in X
-- X = X shr N
-- Y is left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte2_SHRX <b>( </b></font><b>byte in </b><font color="#000080">N <b>= </b></font><font color="#FF0000">1 </font><font color="#000080"><b>) </b></font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">next
  next<b>:                  </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">bcf      status<b>,</b>C    </font><font color="#808080"><i>;clear Carry
    </i></font><font color="#000080">rrf      x2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rrf      x1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">decfsz   N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     next        </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------


-- -----------------------------------------------------------------------------
-- 24 bit shift Right routine in X
-- X = X shr N
-- Y is left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_SHRX <b>( </b></font><b>byte in </b><font color="#000080">N <b>= </b></font><font color="#FF0000">1 </font><font color="#000080"><b>) </b></font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">next
  next<b>:                  </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">bcf      status<b>,</b>C    </font><font color="#808080"><i>;clear Carry
    </i></font><font color="#000080">rrf      x3<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rrf      x2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rrf      x1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">decfsz   N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     next        </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------


-- -----------------------------------------------------------------------------
-- 24 bit shift/rotate Right routine
-- if shift (default)  then Y = Y shr N
-- if rotate           then Y = Y ror N
-- X is left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_SRR <b>( </b></font><b>byte in </b><font color="#000080">N <b>= </b></font><font color="#FF0000">1 </font><font color="#000080"><b>, </b></font><b>bit in </b><font color="#000080">rotate <b>= </b></font><font color="#FF0000">false </font><font color="#000080"><b>) </b></font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">next<b>, </b>no_rotate
  next<b>:                  </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">bcf      status<b>,</b>C    </font><font color="#808080"><i>;clear Carry
    </i></font><font color="#000080">btfss    rotate      </font><font color="#808080"><i>;test if rotate
    </i></font><font color="#000080">goto     no_rotate   </font><font color="#808080"><i>;if shift rather than rotate
    </i></font><font color="#000080">btfsc    y1<b>,</b></font><font color="#FF0000">0        </font><font color="#808080"><i>;if rotate, test lsb
    </i></font><font color="#000080">bsf      status<b>,</b>C    </font><font color="#808080"><i>;set Carry according to lsb
  </i></font><font color="#000080">no_rotate<b>:             </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">rrf      y3<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rrf      y2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rrf      y1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">decfsz   N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     next        </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------



-- -----------------------------------------------------------------------------
-- N,2,3,4 byte ADD routine
-- Y = Y + X
-- X is left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byteN_ADD </font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">carry_y2<b>, </b>carry_y3<b>, </b>carry_y4<b>, </b>start

    goto     start       </font><font color="#808080"><i>;

  -- this method can easily be expanded to more bytes
  </i></font><font color="#000080">carry_y2<b>:              </b></font><font color="#808080"><i>;aggregate the Carry through all the bytes
    </i></font><font color="#000080">incfsz   y2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><b>return               </b><font color="#808080"><i>;
  </i></font><font color="#000080">carry_y3<b>:
    </b>incfsz   y3<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><b>return               </b><font color="#808080"><i>;
  </i></font><font color="#000080">carry_y4<b>:
    </b>incf     y4<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><b>return               </b><font color="#808080"><i>;

  </i></font><font color="#000080">start<b>:                 </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">movf     x1<b>,</b>w        </font><font color="#808080"><i>; W = X1
    </i></font><font color="#000080">addwf    y1<b>,</b>f        </font><font color="#808080"><i>; Y1 = Y1 + X1
    </i></font><font color="#000080">btfsc    status<b>,</b>C    </font><font color="#808080"><i>; skip if no Carry
    </i></font><font color="#000080">call     carry_y2    </font><font color="#808080"><i>; add Carry

    </i></font><font color="#000080">movf     x2<b>,</b>w        </font><font color="#808080"><i>; W = X2
    </i></font><font color="#000080">addwf    y2<b>,</b>f        </font><font color="#808080"><i>; Y2 = Y2 + X2
    </i></font><font color="#000080">btfsc    status<b>,</b>C    </font><font color="#808080"><i>; skip if no Carry
    </i></font><font color="#000080">call     carry_y3    </font><font color="#808080"><i>; add Carry

    </i></font><font color="#000080">movf     x3<b>,</b>w        </font><font color="#808080"><i>; W = X3
    </i></font><font color="#000080">addwf    y3<b>,</b>f        </font><font color="#808080"><i>; Y3 = Y3 + X3
    </i></font><font color="#000080">btfsc    status<b>,</b>C    </font><font color="#808080"><i>; skip if no Carry
    </i></font><font color="#000080">call     carry_y4    </font><font color="#808080"><i>; add Carry

    </i></font><font color="#000080">movf     x4<b>,</b>w        </font><font color="#808080"><i>; W = X4
    </i></font><font color="#000080">addwf    y4<b>,</b>f        </font><font color="#808080"><i>; Y4 = Y4 + X4
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte2_ADD </font><b>is
  </b><font color="#000080">byteN_add
</font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_ADD </font><b>is
  </b><font color="#000080">byteN_add
</font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte4_ADD </font><b>is
  </b><font color="#000080">byteN_add
</font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------


-- -----------------------------------------------------------------------------
-- N,2,3,4 bytes CMP routine
-- if X=Y then Z1=0 else Z1=1
-- X, Y, Z4,Z3,X2 are left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byteN_cmp  <b>(</b></font><b>byte in </b><font color="#000080">N<b>) </b></font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">byte4<b>, </b>byte3<b>, </b>byte2<b>, </b>byte1<b>, </b>equal<b>, </b>not_equal<b>, </b>finish
  
    decf     N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">btfsc    Z           </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     byte1       </font><font color="#808080"><i>;if ZERO (N=1)
    </i></font><font color="#000080">decf     N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">btfsc    Z           </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     byte2       </font><font color="#808080"><i>;if ZERO (N=2)
    </i></font><font color="#000080">decf     N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">btfsc    Z           </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     byte3       </font><font color="#808080"><i>;if ZERO (N=3)

  </i></font><font color="#000080">byte4<b>:                 </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">movf     x4<b>,</b>w        </font><font color="#808080"><i>;
    </i></font><font color="#000080">subwf    y4<b>,</b>w        </font><font color="#808080"><i>;
    </i></font><font color="#000080">btfss    Z           </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     not_equal   </font><font color="#808080"><i>;
  </i></font><font color="#000080">byte3<b>:                 </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">movf     x3<b>,</b>w        </font><font color="#808080"><i>;
    </i></font><font color="#000080">subwf    y3<b>,</b>w        </font><font color="#808080"><i>;
    </i></font><font color="#000080">btfss    Z           </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     not_equal   </font><font color="#808080"><i>;
  </i></font><font color="#000080">byte2<b>:
    </b>movf     x2<b>,</b>w        </font><font color="#808080"><i>;
    </i></font><font color="#000080">subwf    y2<b>,</b>w        </font><font color="#808080"><i>;
    </i></font><font color="#000080">btfss    Z           </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     not_equal   </font><font color="#808080"><i>;
  </i></font><font color="#000080">byte1<b>:
    </b>movf     x1<b>,</b>w        </font><font color="#808080"><i>;
    </i></font><font color="#000080">subwf    y1<b>,</b>w        </font><font color="#808080"><i>;
    </i></font><font color="#000080">btfss    Z           </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     not_equal   </font><font color="#808080"><i>;

  </i></font><font color="#000080">equal<b>:                 </b></font><font color="#808080"><i>;
    </i></font><font color="#800080"><i>movlw    </i></font><font color="#FF0000">0           </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     finish      </font><font color="#808080"><i>;
  </i></font><font color="#000080">not_equal<b>:             </b></font><font color="#808080"><i>;
    </i></font><font color="#800080"><i>movlw    </i></font><font color="#FF0000">1           </font><font color="#808080"><i>;
  </i></font><font color="#000080">finish<b>:                </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">movwf    z1          </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte2_CMP </font><b>is
  </b><font color="#000080">byteN_CMP <b>(</b></font><font color="#FF0000">2</font><font color="#000080"><b>)
</b></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_CMP </font><b>is
  </b><font color="#000080">byteN_CMP <b>(</b></font><font color="#FF0000">3</font><font color="#000080"><b>)
</b></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte4_CMP </font><b>is
  </b><font color="#000080">byteN_CMP <b>(</b></font><font color="#FF0000">4</font><font color="#000080"><b>)
</b></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
</i></font><b>function </b><font color="#000080">byteN_fcmp <b>(</b></font><b>byte in </b><font color="#000080">N<b>) </b></font><b>return bit is
  </b><font color="#000080">byteN_cmp <b>(</b>N<b>)
  </b></font><b>return </b><font color="#000080">Z1 <b>== </b></font><font color="#FF0000">0
</font><b>end function
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------




-- -----------------------------------------------------------------------------
-- N,2,3,4 bytes INC routine
-- Y = Y + 1
-- if Y=0 then Z1=0 else Z1=1
-- X, Z4,Z3,X2 are left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte2_INC </font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">non_zero<b>, </b>finish
    incfsz   y1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     non_zero    </font><font color="#808080"><i>;
    </i></font><font color="#000080">incfsz   y2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     non_zero    </font><font color="#808080"><i>;
    </i></font><font color="#800080"><i>movlw    </i></font><font color="#FF0000">0           </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     finish      </font><font color="#808080"><i>;
  </i></font><font color="#000080">non_zero<b>:              </b></font><font color="#808080"><i>;
    </i></font><font color="#800080"><i>movlw    </i></font><font color="#FF0000">1           </font><font color="#808080"><i>;
  </i></font><font color="#000080">finish<b>:                </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">movwf    z1          </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_INC </font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">non_zero<b>, </b>finish
    incfsz   y1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     non_zero    </font><font color="#808080"><i>;
    </i></font><font color="#000080">incfsz   y2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     non_zero    </font><font color="#808080"><i>;
    </i></font><font color="#000080">incfsz   y3<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     non_zero    </font><font color="#808080"><i>;
    </i></font><font color="#800080"><i>movlw    </i></font><font color="#FF0000">0           </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     finish      </font><font color="#808080"><i>;
  </i></font><font color="#000080">non_zero<b>:              </b></font><font color="#808080"><i>;
    </i></font><font color="#800080"><i>movlw    </i></font><font color="#FF0000">1           </font><font color="#808080"><i>;
  </i></font><font color="#000080">finish<b>:                </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">movwf    z1          </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte4_INC </font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">non_zero<b>, </b>finish
    incfsz   y1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     non_zero    </font><font color="#808080"><i>;
    </i></font><font color="#000080">incfsz   y2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     non_zero    </font><font color="#808080"><i>;
    </i></font><font color="#000080">incfsz   y3<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     non_zero    </font><font color="#808080"><i>;
    </i></font><font color="#000080">incfsz   y4<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     non_zero    </font><font color="#808080"><i>;
    </i></font><font color="#800080"><i>movlw    </i></font><font color="#FF0000">0           </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     finish      </font><font color="#808080"><i>;
  </i></font><font color="#000080">non_zero<b>:              </b></font><font color="#808080"><i>;
    </i></font><font color="#800080"><i>movlw    </i></font><font color="#FF0000">1           </font><font color="#808080"><i>;
  </i></font><font color="#000080">finish<b>:                </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">movwf    z1          </font><font color="#808080"><i>;
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byteN_INC <b>(</b></font><b>byte in </b><font color="#000080">N<b>) </b></font><b>is
  if    </b><font color="#000080">N <b>== </b></font><font color="#FF0000">2 </font><b>then </b><font color="#000080">byte2_inc
  </font><b>elsif </b><font color="#000080">N <b>== </b></font><font color="#FF0000">3 </font><b>then </b><font color="#000080">byte3_inc
  </font><b>elsif </b><font color="#000080">N <b>== </b></font><font color="#FF0000">4 </font><b>then </b><font color="#000080">byte4_inc
  </font><b>else </b><font color="#800080"><i>pragma </i></font><b>error   </b><font color="#808080"><i>-- invalid number of bytes
  </i></font><b>end if
end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------


-- -----------------------------------------------------------------------------
-- 24 bit multiply routine
-- Y = Y * X
-- X is CHANGED !!
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_MUL </font><b>is
var byte </b><font color="#000080">s3<b>, </b>s2<b>, </b>s1<b>, </b>N
  </font><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">next<b>, </b>no_add
    movfw    y3          </font><font color="#808080"><i>; S = Y
    </i></font><font color="#000080">movwf    s3          </font><font color="#808080"><i>;
    </i></font><font color="#000080">movfw    y2          </font><font color="#808080"><i>;
    </i></font><font color="#000080">movwf    s2          </font><font color="#808080"><i>;
    </i></font><font color="#000080">movfw    y1          </font><font color="#808080"><i>;
    </i></font><font color="#000080">movwf    s1          </font><font color="#808080"><i>;
                         ;
    </i></font><font color="#800080"><i>movlw    </i></font><font color="#FF0000">0           </font><font color="#808080"><i>; Y = 0
    </i></font><font color="#000080">movwf    y3          </font><font color="#808080"><i>;
    </i></font><font color="#000080">movwf    y2          </font><font color="#808080"><i>;
    </i></font><font color="#000080">movwf    y1          </font><font color="#808080"><i>;
    </i></font><font color="#800080"><i>movlw    </i></font><font color="#FF0000">24          </font><font color="#808080"><i>;
    </i></font><font color="#000080">movwf    N           </font><font color="#808080"><i>;
  </i></font><font color="#000080">next<b>:                  </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">btfss    S1<b>,</b></font><font color="#FF0000">0        </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     no_add      </font><font color="#808080"><i>;
    </i></font><font color="#000080">call     byte3_add   </font><font color="#808080"><i>; Y = Y + X
    ;clip at overflow
  </i></font><font color="#000080">no_add<b>:                </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">bcf      C           </font><font color="#808080"><i>; X = X shl 1 (shift in Carry = 0)
    </i></font><font color="#000080">rlf      x1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rlf      x2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rlf      x3<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rrf      s3<b>,</b>f        </font><font color="#808080"><i>; S = S shr 1 (carry is don't care)
    </i></font><font color="#000080">rrf      s2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">rrf      s1<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">decfsz   N<b>,</b>f         </font><font color="#808080"><i>;
    </i></font><font color="#000080">goto     next        </font><font color="#808080"><i>;
                         ;

  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------



-- -----------------------------------------------------------------------------
-- N,2,3,4 byte SUB routine
-- Y = Y - X
-- X is left unchanged
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byteN_SUB </font><b>is
  </b><font color="#800080"><i>assembler
  pragma keep page
  local </i></font><font color="#000080">borrow_y2<b>, </b>borrow_y3<b>, </b>borrow_y4<b>, </b>start
  </font><font color="#800080"><i>page </i></font><font color="#000080">start

    goto     start       </font><font color="#808080"><i>;

  -- this method can easily be expanded to more bytes
  </i></font><font color="#000080">borrow_y2<b>:             </b></font><font color="#808080"><i>;aggregate the Borrow through all the bytes
    </i></font><font color="#000080">decf     y2<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">comf     y2<b>,</b>w        </font><font color="#808080"><i>;
    </i></font><font color="#000080">btfss    status<b>,</b>Z    </font><font color="#808080"><i>;
    </i></font><b>return               </b><font color="#808080"><i>;
  </i></font><font color="#000080">borrow_y3<b>:             </b></font><font color="#808080"><i>;aggregate the Borrow through all the bytes
    </i></font><font color="#000080">decf     y3<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><font color="#000080">comf     y3<b>,</b>w        </font><font color="#808080"><i>;
    </i></font><font color="#000080">btfss    status<b>,</b>Z    </font><font color="#808080"><i>;
    </i></font><b>return               </b><font color="#808080"><i>;
  </i></font><font color="#000080">borrow_y4<b>:
    </b>decf     y4<b>,</b>f        </font><font color="#808080"><i>;
    </i></font><b>return               </b><font color="#808080"><i>;

  </i></font><font color="#000080">start<b>:                 </b></font><font color="#808080"><i>;
    </i></font><font color="#000080">movf     x1<b>,</b>w        </font><font color="#808080"><i>; W = X1
    </i></font><font color="#000080">subwf    y1<b>,</b>f        </font><font color="#808080"><i>; Y1 = Y1 - X1
    </i></font><font color="#000080">btfss    status<b>,</b>C    </font><font color="#808080"><i>; skip if no Borrow
    </i></font><font color="#000080">call     borrow_y2   </font><font color="#808080"><i>; subtract Borrow

    </i></font><font color="#000080">movf     x2<b>,</b>w        </font><font color="#808080"><i>; W = X2
    </i></font><font color="#000080">subwf    y2<b>,</b>f        </font><font color="#808080"><i>; Y2 = Y2 - X2
    </i></font><font color="#000080">btfss    status<b>,</b>C    </font><font color="#808080"><i>; skip if no Borrow
    </i></font><font color="#000080">call     borrow_y3   </font><font color="#808080"><i>; subtract Borrow

    </i></font><font color="#000080">movf     x3<b>,</b>w        </font><font color="#808080"><i>; W = X3
    </i></font><font color="#000080">subwf    y3<b>,</b>f        </font><font color="#808080"><i>; Y3 = Y3 - X3
    </i></font><font color="#000080">btfss    status<b>,</b>C    </font><font color="#808080"><i>; skip if no Borrow
    </i></font><font color="#000080">call     borrow_y4   </font><font color="#808080"><i>; subtract Borrow

    </i></font><font color="#000080">movf     x4<b>,</b>w        </font><font color="#808080"><i>; W = X4
    </i></font><font color="#000080">subwf    y4<b>,</b>f        </font><font color="#808080"><i>; Y4 = Y4 - X4
  </i></font><b>end </b><font color="#800080"><i>assembler
</i></font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte2_SUB </font><b>is
  </b><font color="#000080">byteN_SUB
</font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_SUB </font><b>is
  </b><font color="#000080">byteN_SUB
</font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte4_SUB </font><b>is
  </b><font color="#000080">byteN_SUB
</font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------



-- -----------------------------------------------------------------------------
-- 24 bit DEC routine
-- Y = Y - 1
-- X = 1
-- -----------------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">byte3_DEC </font><b>is
  </b><font color="#000080">X1 <b>= </b></font><font color="#FF0000">1
  </font><font color="#000080">X2 <b>= </b></font><font color="#FF0000">0
  </font><font color="#000080">X3 <b>= </b></font><font color="#FF0000">0
  </font><font color="#000080">byte3_SUB
</font><b>end procedure
</b><font color="#808080"><i>-- -----------------------------------------------------------------------------


</i></font></font>
</code></pre>
</body>
</html>
