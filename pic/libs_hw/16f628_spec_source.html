<html>
<head>
<title>JALcc SourceCode exporting of 16f628_spec_source.html</title>
</head>
<!-- Generated by SynEdit HTML exporter -->
<body text="#000000" bgcolor="#FFFFFF">
<pre>
<code><font  size=3 face="Courier New"><font color="#000080"><A href="16f628_spec.jal">download&nbsp;16f628_spec.jal</A>

</font><font color="#808080"><i>-- --------------------------------------------------------------------
-- procedure Vref_init (
--   bit in high_low_range = true ,
--   bit in output_enabled = false ) is
-- --------------------------------------------------------------------
-- procedure Vref_off is
-- --------------------------------------------------------------------
-- procedure Vref_set ( byte in Vref ) is
-- --------------------------------------------------------------------


-- --------------------------------------------------------------------
-- Comparator constants
-- --------------------------------------------------------------------
</i></font><b>const byte </b><font color="#000080">_CMCOM_mode0 <b>= </b></font><font color="#FF0000">0  </font><font color="#808080"><i>-- all comparator, but outputs reset (0)
</i></font><b>const byte </b><font color="#000080">_CMCOM_mode1 <b>= </b></font><font color="#FF0000">1  </font><font color="#808080"><i>-- this mode is not working, use mode 5 instead
</i></font><b>const byte </b><font color="#000080">_CMCOM_mode2 <b>= </b></font><font color="#FF0000">2  </font><font color="#808080"><i>-- A0,A1,A2,A4-Vref (4 comparators !!)
</i></font><b>const byte </b><font color="#000080">_CMCOM_mode3 <b>= </b></font><font color="#FF0000">3  </font><font color="#808080"><i>-- A2-A1 , A2-A0 = comparator , A3 = digital
</i></font><b>const byte </b><font color="#000080">_CMCOM_mode4 <b>= </b></font><font color="#FF0000">4  </font><font color="#808080"><i>-- A2-A1 , A0-A3 = comparator
</i></font><b>const byte </b><font color="#000080">_CMCOM_mode5 <b>= </b></font><font color="#FF0000">5  </font><font color="#808080"><i>-- A2-A1 = comparator    A0,A3 = digital
</i></font><b>const byte </b><font color="#000080">_CMCOM_mode6 <b>= </b></font><font color="#FF0000">6  </font><font color="#808080"><i>-- A2-A1 , A2-A0 = comparator,
                             -- A3 = output(A2-A0)
                             -- A4 = output(A2-A1) open drain !!
</i></font><b>const byte </b><font color="#000080">_CMCOM_mode7 <b>= </b></font><font color="#FF0000">7  </font><font color="#808080"><i>-- A0..A3 = digital , no comparator
-- --------------------------------------------------------------------



-- --------------------------------------------------------------------
-- global definitions
-- --------------------------------------------------------------------
</i></font><b>var byte </b><font color="#000080">vrcon_shadow    </font><font color="#808080"><i>-- contains settings with Vref=0 !!



-- --------------------------------------------------------------------
-- Initializes the Vref generator,
-- multiplexer = 0
--   high_low_range
--     = true,  Vout = Vdd * Vref / 24
--     = false, Vout = ( Vdd * Vref / 32 ) + ( Vdd / 4 )
--   output_enabled
--     = true,  pin_A2 (IC-pin 1) is set to input !!
--              if set to output, extra current comsumption and no output
--     = false, pin_A2 is left unchanged
--
-- The user is responsible for setting _CMCON correct
-- Pay special attention to the use of A2, because incresed current consumption
-- can occure if this pin is driven by different sources.
--
-- The setting of Vref generator is stored in the global vrcon_shadow
-- --------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">Vref_init <b>(
  </b></font><b>bit in </b><font color="#000080">high_low_range <b>= </b></font><font color="#FF0000">true </font><font color="#000080"><b>,
  </b></font><b>bit in </b><font color="#000080">output_enabled <b>= </b></font><font color="#FF0000">false </font><font color="#000080"><b>) </b></font><b>is

  </b><font color="#808080"><i>-- if output enabled, set A2 as INPUT !!!
  -- otherwise do nothing
  </i></font><b>if </b><font color="#000080">output_enabled </font><b>then </b><font color="#000080">pin_a2_direction <b>= </b></font><font color="#FF0000">input </font><b>end if
  
  </b><font color="#808080"><i>-- set VRCON, with the mux at the lowest value
  -- vrcon_shadow contains the settings without Vref !!
  </i></font><font color="#000080">vrcon_shadow <b>= </b></font><font color="#FF0000">0x80
  </font><b>if </b><font color="#000080">high_low_range </font><b>then </b><font color="#000080">vrcon_shadow <b>= </b>vrcon_shadow <b>| </b></font><font color="#FF0000">0x20 </font><b>end if
  if </b><font color="#000080">output_enabled </font><b>then </b><font color="#000080">vrcon_shadow <b>= </b>vrcon_shadow <b>| </b></font><font color="#FF0000">0x40 </font><b>end if
  </b><font color="#000080">VRCON <b>= </b>vrcon_shadow
</font><b>end procedure
</b><font color="#808080"><i>-- --------------------------------------------------------------------



-- --------------------------------------------------------------------
-- set the Vref generator off,
-- by disabling Vref, disabling output,
-- pin A2 is not affected
-- --------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">Vref_off </font><b>is
  </b><font color="#000080">VRCON <b>= </b></font><font color="#FF0000">0
</font><b>end procedure
</b><font color="#808080"><i>-- --------------------------------------------------------------------



-- --------------------------------------------------------------------
-- set the Vref multiplexer
-- all other Vref settings are not affected
-- --------------------------------------------------------------------
</i></font><b>procedure </b><font color="#000080">Vref_set <b>( </b></font><b>byte in </b><font color="#000080">Vref <b>) </b></font><b>is
  </b><font color="#000080">VRCON <b>= </b>vrcon_shadow <b>| ( </b>Vref <b>&amp; </b></font><font color="#FF0000">0x0F </font><font color="#000080"><b>)
  </b></font><font color="#808080"><i>-- don't know yet if this is usefull ???
  -- delay 10 us
</i></font><b>end procedure
</b><font color="#808080"><i>-- --------------------------------------------------------------------
</i></font></font>
</code></pre>
</body>
</html>
