<HTML><HEAD><TITLE>PIC-AD</TITLE>
<STYLE type="text/css"><!--
BODY {
  margin: 5px 5px 5px 5px;
  background-color: #E8E8E8;
}

--></STYLE>
<LINK type="text/css" href="rvf.css" rel=STYLESHEET>
<link rel="icon" href="jalccring_small.gif" type="image/gif"></HEAD>
<BODY>

<P><SPAN class=RVTS1>PIC-AD</SPAN></P>
<P><SPAN class=RVTS7>This html document is automatically generated by JALcc, from the JAL-sourcefile</SPAN></P>
<P><SPAN class=RVTS7>pic_adc.jal&nbsp;&nbsp; 09-08-2004</SPAN></P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Description&nbsp;</SPAN></P>
<P>Library to use the PIC's AD converter see the example below, how to use it&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P>procedure PIC_ADC_init&nbsp;</P>
<P>procedure PIC_ADC_read_low_res (chan, sample)&nbsp;</P>
<P>procedure PIC_ADC_read&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (chan, highsample, lowsample)&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P>hardware, see 16F87x datasheet (DS30292C, p112)&nbsp;</P>
<P>number of channels, behind "--" yields only for 16F874 and 16F877&nbsp;</P>
<P>no external Vref: Nchan = 1,3,5 -- 6,8&nbsp;</P>
<P>only external +Vref: Nchan = 2,4 -- 5,7&nbsp;</P>
<P>both external +Vref and - Vref: Nchan = 1,2,3 -- 4,6&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P>analog channels can still be used as digital outputs, by setting&nbsp;</P>
<P>pin = output&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P>relevant IO pins&nbsp;</P>
<P>RA0 = AN0&nbsp;</P>
<P>RA1 = AN1&nbsp;</P>
<P>RA2 = AN2&nbsp; or&nbsp; -Vref&nbsp;</P>
<P>RA3 = AN3&nbsp; or&nbsp; +Vref&nbsp;</P>
<P>RA4 = no analog IO&nbsp;</P>
<P>RA5 = AN4&nbsp;</P>
<P>next pins only for 16F874 and 16F877&nbsp;</P>
<P>RE0 = AN5&nbsp;</P>
<P>RE1 = AN6&nbsp;</P>
<P>RE2 = AN7&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P>Background Information I mixed the following libraries with my own ideas&nbsp;</P>
<P>f877_modules.jal from Javi&nbsp;</P>
<P>janalog.jal from Vasile&nbsp;</P>
<P>&nbsp;&nbsp;Rick Turtel has extended the library with 16F88 support, see&nbsp;</P>
<P><A class=RVTS4 href="http://www.geocities.com/fun_4_me_now20012000/jal_page.html">http://www.geocities.com/fun_4_me_now20012000/jal_page.html</A></P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Example PIC-AD&nbsp;</SPAN></P>
<P>&nbsp;-- (if you use JALcc, you can copy the complete example below and "uncomment" it)&nbsp;</P>
<P>&nbsp;-- define the AD converter settings&nbsp;</P>
<P>&nbsp;const PIC_ADC_Nchan&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;number of selected channels&nbsp;</P>
<P>&nbsp;const PIC_ADC_NVref&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;number of external references&nbsp;</P>
<P>&nbsp;const PIC_ADC_Rsource&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 20_000&nbsp;&nbsp; ;maximum source resistance (max recommended = 10 kOhm)&nbsp;</P>
<P>&nbsp;const PIC_ADC_high_resolution = true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;true = high resolution = 10 bits&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;false = low resolution = 8 bits&nbsp;</P>
<P>&nbsp;-- get the library, after defining the constants&nbsp;</P>
<P>&nbsp;include pic_adc&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;-- initialize the AD converter according to the above parameters&nbsp;</P>
<P>&nbsp;PIC_ADC_init&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;-- now take a sample&nbsp;</P>
<P>&nbsp;-- (choose the correct routine according to the selected resolution)&nbsp;</P>
<P>&nbsp;PIC_ADC_read (chan, xH, xL)&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>License&nbsp;</SPAN></P>
<P>freeware, under the terms of the GNU GPL&nbsp;</P>
<P>Copyright (C) 2002 Stef Mientki&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS1>Version History</SPAN></P>
<P><A class=RVTS4 href="pic_adc.jal">download&nbsp; pic_adc.jal</A></P>
<P><A class=RVTS4 href="pic_adc_source.html">colorcoded HTML&nbsp; pic_adc_source.html</A></P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 2.2 23-03-2004, Stef Mienti&nbsp;</SPAN></P>
<P>- errors in IO-direction assignment corrected (was pin_a2=input)&nbsp;</P>
<P>(Thanks to Rick Turtel)&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 2.1 16-10-2003, Stef Mientki,&nbsp;</SPAN></P>
<P>- 16F87x, 1 channel + NoRef didn't work, bug fixed&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 2.0 05-04-2003, Stef Mientki,&nbsp;</SPAN></P>
<P>- 12F675 support added&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Version: 1.0&nbsp; 10-04-2003, Stef Mientki&nbsp;</SPAN></P>
<P>- orginal release&nbsp;</P>
<P>- _PIC_ADC_init_1_Vref&nbsp; (not tested)&nbsp;</P>
<P>- _PIC_ADC_init_2_Vref&nbsp; (not tested)&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>Included Files</SPAN></P>
<P>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS1>Public Procedures</SPAN></P>
<P><SPAN class=RVTS2>procedure PIC_ADC_read_low_res</SPAN></P>
<P>-- Does an AD conversion with low resolution (8 bit) on the selected channel</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure PIC_ADC_read</SPAN></P>
<P>-- Does an AD conversion with high resolution (10 bit) on the selected channel</P>
<P>&nbsp;&nbsp;</P>
<P><SPAN class=RVTS2>procedure PIC_ADC_init</SPAN></P>
<P>-- initializes the PIC AD-converter,</P>
<P>-- by calling the correct routine according to the number of external references</P>
<P>-- settings are done according to the special ADC constants</P>
<P>-- sets all the analog pins to input</P>
<P>-- calculates aquisition time</P>
<P>-- and determines if right or left justification is optimal</P>
</BODY></HTML>
