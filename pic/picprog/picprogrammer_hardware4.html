<!DOCTYPE doctype PUBLIC "-//w3c//dtd html 4.0 transitional//en"><html><head>

 
  
  <link rel="STYLESHEET" type="text/css" href="picoverview.css" title="none">



   
  
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">



   
  
  <meta name="author" content="Stef Mientki">



   
  
  <meta name="generator" content="Mozilla/4.7 [en-gb] (Win98; U) [Netscape]">
  <title>NOP Serial Port PicProgrammer</title>
</head><body text="#000000" bgcolor="#33ff33" link="#0000ee" vlink="#551a8b" alink="#ff0000">
<table width="100%">



<tbody><tr>

<td align="left" valign="top"><a href="picprogrammer_software.html">Software</a>

      <p><a href="picprogrammer_software.html#downloads">Download</a></p>
      <br>
</td>



<td align="center" valign="top">
      <h2>

Mindstorms PIC programmer&nbsp;</h2>
      <h2>(hardware version 4)</h2>
      </td>



<td align="right" valign="top">
      <h3>23 december 2001</h3>
      
</td></tr></tbody>
</table>

<h3>



</h3>

<table width="100%">

  <tbody>
    <tr>
    </tr>
  </tbody>
</table>





<p><a name="why another picprogrammer"></a><b><font face="Arial,Helvetica"><font color="#3333ff">Why

another PICprogrammer&nbsp;</font></font></b><a href="#top"><img src="top_page.gif" height="14" width="14"></a>

<br><font face="Arial,Helvetica">The reason is simple, everything I tried

didn't work for 100% (specially programming the normal version of the PIC16F84

give rise to problems). For more background information and things I tried,

see <a href="picprogrammer_hardware1.html">hardware version 1</a>. Version

2, which contains some needless applications components can be found <a href="picprogrammer_hardware2.html">here</a>.</font>

</p>

<p><a name="specifications"></a><b><font face="Arial,Helvetica"><font color="#3333ff">Specifications&nbsp;</font></font></b><a href="#top"><img src="top_page.gif" height="14" width="14"></a>

<br><font face="Arial,Helvetica">The programmer connects to a free RS232

port of the PC and doesn't need external power supply.</font>

<br><font face="Arial,Helvetica">The programmer is tested under windows-98

on a PII-66 and a PIII-1000.</font>

<br><font face="Arial,Helvetica">Everything, including sources, is available

(for free of course).</font>

</p>

<p><a name="tested pics (ordened by family)"></a><b><font face="Arial,Helvetica"><font color="#3333ff">Tested

PICs (ordened by family)</font></font></b>

<table border="1" cols="6" width="100%">

<tbody><tr>

<td><b><font face="Arial,Helvetica"><font color="#3333ff">16x8x</font></font></b></td>



<td><b><font face="Arial,Helvetica"><font color="#3333ff">16F62x</font></font></b></td>



<td><b><font face="Arial,Helvetica"><font color="#3333ff">16F87x</font></font></b></td>



<td><br>
</td>



<td><br>
</td>



<td><br>
</td>

</tr>



<tr>

<td><font face="Arial,Helvetica">16F84</font>

<br><font face="Arial,Helvetica">16F84A</font></td>



<td>16F628</td>



<td><font face="Arial,Helvetica">16F876</font></td>



<td><br>
</td>



<td><br>
</td>



<td><br>
</td>

</tr>

</tbody></table>



</p>

<p><a name="operating instructions"></a><b><font face="Arial,Helvetica"><font color="#3333ff">Operating

Instructions&nbsp;</font></font></b><a href="#top"><img src="top_page.gif" height="14" width="14"></a>

<br><font face="Arial,Helvetica"><font color="#000000">It's important to

follow the steps described below in the right order, because applying a

voltage to the programmer pin of the PIC, without the PIC is supplied from

a +5Volt source, can damage the PIC.</font></font>

</p>

<ol>



<li>

<font face="Arial,Helvetica"><i><u>start the program and select the right

RS232 port</u></i> (this will ensure that the voltage on the programmer

will be ok) The voltages generated by the circuit can be tested before

inserting a PIC, <a href="picprogrammer_software.html#test_hardware">see

here</a>)</font></li>



<li>

<font face="Arial,Helvetica">set the switch on <i><u>the programmer in

the run mode</u></i> (this will ensure that the program voltage will not

be present until the +5Volt is present)</font></li>



<li>

<font face="Arial,Helvetica">now <i><u>connect the programmer</u></i> to

the selected RS232 port</font></li>



<li>

<font face="Arial,Helvetica">now you can savely put the switch on <i><u>the

programmer in program mode</u></i></font></li>

</ol>





<p><br><a name="circuit"></a><b><font face="Arial,Helvetica"><font color="#3333ff">Circuit&nbsp;</font></font></b><a href="#top"><img src="top_page.gif" height="14" width="14"></a>

<br><font face="Arial,Helvetica">The circuit shown below is straight forward.

The major differences with other simple programmers is the feedback lines

for both clock and data signals (see for futher details, the <a href="#the%20design">current

design</a>).</font>

<br><font face="Arial,Helvetica">You can roughly test if your serial port

is capable of delivering enough current, by connecting a resistor between

DTR and GND and measuring the voltage.</font>

</p>

<p><font face="Arial,Helvetica">Finding the optimal signal connections</font>

<table border="1" width="100%">

<tbody><tr>

<td><br>
</td>



<td><b><font color="#3333ff">Programming</font></b></td>



<td><b><font color="#3333ff">Running</font></b></td>



<td><b><font color="#3333ff">RCX</font></b></td>



<td><b><font color="#3333ff">MindScope</font></b></td>

</tr>



<tr>

<td>DTR</td>



<td>program clock,

<br>when 0 = +5V power</td>



<td>0 = 5V power supply for PIC</td>



<td>not used, low</td>



<td>1 = power generating for batteryless tower</td>

</tr>



<tr>

<td>DSR</td>



<td>echo of DTR (clock)</td>



<td>-</td>



<td>-</td>



<td>-</td>

</tr>



<tr>

<td>RTS</td>



<td>program data,

<br>power for RS232 from PIC

<br>when 0 = +5V power</td>



<td>1 = enable PIC,&nbsp;

<br>power for RS232</td>



<td>1 = tower on

<br>0 = tower off (after 3 seconds)</td>



<td>1 = tower on

<br>0 = tower off</td>

</tr>



<tr>

<td>CTS</td>



<td>echo of RTS (data)

<br>or

<br>Read data</td>



<td>-</td>



<td>= RTS,&nbsp;

<br>used to check if tower is present</td>



<td>= RTS</td>

</tr>



<tr>

<td>TxD</td>



<td>+5V power supply</td>



<td>RS232 data to PIC

<br>when 0=+5V power supply</td>



<td>TxD</td>



<td>TxD</td>

</tr>



<tr>

<td>RxD</td>



<td>-</td>



<td>RS232 data from PIC,

<br>gets positive power supply from RTS</td>



<td>RxD</td>



<td>RxD</td>

</tr>

</tbody></table>



</p>

<blockquote><font face="Arial,Helvetica">Start the program, Tools / Settings

/ Commport / ...</font>

<br><font face="Arial,Helvetica">Connect to right port, enable DTR and

measure the voltage between DTR (pin 4) and GND (pin5)</font>

<br><font face="Arial,Helvetica">The voltage should be &gt;=5Volt, for the

resistor value yields</font>

<br><font face="Arial,Helvetica">&nbsp;&nbsp;&nbsp;&nbsp; 1 kOhm&nbsp;

--&gt; 5 mA&nbsp; (will do for the new devices, i.e. 16F84A)</font>

<br><font face="Arial,Helvetica">&nbsp;&nbsp;&nbsp;&nbsp; 500 Ohm&nbsp;

--&gt; 10 mA&nbsp; (necessary for old devices, i.e. 16F84</font></blockquote>





<br>

&nbsp;

<table border="1" width="100%">



<tbody><tr>

<td valign="top"><a name="the nop programmer circuit"></a><b><font color="#3333ff">The

NOP programmer circuit&nbsp;</font></b><a href="#top"><img src="top_page.gif" height="14" width="14"></a>

<br>&nbsp;

<p><font color="#000000">You can just connect a PIC (without an oscillator

X-tal) as shown below.</font>

</p><p><font color="#000000">&nbsp;&nbsp; or</font>

</p><p><font color="#000000">You can connect a complete application to this

programmer.</font>

<br><font color="#000000">In that case the application will also by supplied

by the RS232 lines.</font>

<br><font color="#000000">A good example of this is the RCX-remote control.</font>

<br><font color="#000000">In this example also a fast serial interface

is shown, which can be very useful for debugging.</font>

<br>&nbsp;

</p><p><b><font color="#3333ff">IMPORTANT</font></b>

<br><font color="#000000">always (dis-)mount the PIC with the switch in

"RUN" mode.</font>

<br>&nbsp;

</p><p><font color="#000000">Function of R2</font>

<br><font color="#000000">The software controls the reset of the processor

through R2.</font>

<br><font color="#000000">BUT, if the application should also be battery

powered, like in the RCX-remote control, you should not connect R2 as indicated.

The reason for this is that if no RS232 power is generated, the cicuit

around Q1 will draw excessive current, draining your batteries.</font></p></td>



<td><img src="programmer_hw1.jpg" border="0" height="432" width="439"></td>

</tr>

</tbody>
</table>





<br>

&nbsp;

<br>

&nbsp;

<table border="1" width="100%">



<tbody><tr>

<td valign="top"><a name="connecting the pic"></a><b><font color="#3333ff">Connecting

a PIC without application&nbsp;</font></b><a href="#top"><img src="top_page.gif" height="14" width="14"></a>

<p><font color="#000000">ERATA: in the version before 23-12-2001, the program

data and clock lines were exchanged.</font></p></td>



<td><img src="programmer_hw2.jpg" height="238" width="290"></td>

</tr>

</tbody>
</table>





<p><a name="testing the circuit"></a><b><font face="Arial,Helvetica"><font color="#3333ff">Testing

the circuit&nbsp;</font></font></b><a href="#top"><img src="top_page.gif" height="14" width="14"></a>

</p>

<ol>



<li>

<font face="Arial,Helvetica">check the wiring</font></li>



<li>

<font face="Arial,Helvetica">always start the program before connecting

the circuit to the RS232 port (another program could set the RS232 port

totally wrong) DON'T INSERT THE PIC YET !!</font></li>



<li>

<font face="Arial,Helvetica">goto menu Tools / Settings / Commport / ...

CTS and DSR panels light yellow</font></li>



<li>

<font face="Arial,Helvetica">set the switch in RUN mode and connect the

circuit to the RS232 port</font></li>



<li>

<font face="Arial,Helvetica">now activate the connect checkbox, and CTS

and DSR panels should light green</font></li>



<li>

<font face="Arial,Helvetica">activate DTR checkbox and the panel on the

right of DTR should light red</font></li>



<li>

<font face="Arial,Helvetica">activate RTS checkbox and the panel on the

right of RTS should light red</font></li>



<li>

<font face="Arial,Helvetica">now set both DTR and RTS inactive</font></li>



<li>

<font face="Arial,Helvetica">Now test if the voltage on the PIC-foot are

according to the next table</font></li>

</ol>





<table border="1" width="100%">



<tbody><tr>

<td><font face="Arial,Helvetica">With the switch in RUN mode, approximally

the following voltages should be measured at the mentioned PIC pins</font>

<br><font face="Arial,Helvetica">&nbsp;&nbsp;&nbsp; pin&nbsp; 4 (MCLR)

= 0 Volt</font>

<br><font face="Arial,Helvetica">&nbsp;&nbsp;&nbsp; pin 12 (program clock)

= 0 Volt</font>

<br><font face="Arial,Helvetica">&nbsp;&nbsp;&nbsp; pin 13 (data clock)

= 1.5 Volt</font>

<br><font face="Arial,Helvetica">&nbsp;&nbsp;&nbsp; pin 14 (Vdd) = 5 Volt</font>

<br><font face="Arial,Helvetica">&nbsp;&nbsp;&nbsp; All other pins should

read 0 Volt.</font></td>



<td><font face="Arial,Helvetica">Setting the program data line (RTS or

DTR) active:&nbsp;</font>

<br><font face="Arial,Helvetica">&nbsp;&nbsp;&nbsp; pin 4 ==&gt; 5 Volt</font>

<br><font face="Arial,Helvetica">&nbsp;&nbsp;&nbsp; pin 13 ==&gt; 4 Volt</font>

<p><font face="Arial,Helvetica">Setting the program clock line (DTR or

RTS) active:&nbsp;</font>

<br><font face="Arial,Helvetica">&nbsp;&nbsp;&nbsp; pin 12 ==&gt; 10 ... 14

Volt</font></p></td>



<td><font face="Arial,Helvetica">Set DTR and RTS inactive again, and then

the program/run swicth in "program"</font>

<p><font face="Arial,Helvetica">Activating DTR and/or RTS and/or send-$FF:</font>

<br><font face="Arial,Helvetica">&nbsp;&nbsp;&nbsp; pin 4 ==&gt; 10 ... 14

Volt</font></p></td>

</tr>

</tbody>
</table>





<ul>



<li>

<font face="Arial,Helvetica">Leave the settings window</font></li>



<li>

<font face="Arial,Helvetica">set program/run switch in "run"</font></li>



<li>

<font face="Arial,Helvetica">Disconnect the programmer from the serial

port</font></li>



<li>

<font face="Arial,Helvetica">Insert the PIC</font></li>



<li>

<font face="Arial,Helvetica">connect to the serial port again</font></li>



<li>

<font face="Arial,Helvetica">set program/run switch in "program"</font></li>



<li>

<font face="Arial,Helvetica">now everthing should work correctly and you

can read for instance the device ID</font></li>

</ul>



<a name="history"></a><b><font face="Arial,Helvetica"><font color="#3333ff">History&nbsp;</font></font></b><a href="#top"><img src="top_page.gif" height="14" width="14"></a>

<br>

&nbsp;

<table border="1" width="100%">



<tbody><tr>

<td><br>
</td>



<td><br>
</td>

</tr>



<tr>

<td><font face="Arial,Helvetica">ideas for the future</font></td>



<td>

<ul>

<li>

<font face="Arial,Helvetica">some suggest small capacitors (of 300 pF ?)

are needed across data and clock lines ?</font></li>

</ul>

</td>

</tr>



<tr>

<td><font face="Arial,Helvetica">3-11-2001</font></td>



<td>

<ul>

<li>

<font face="Arial,Helvetica">disabling the oscillator, in case a X-tal

is connected to the PIC</font></li>



<li>

<font face="Arial,Helvetica">connector with signals for in-circuit-programming

of PIC's on other boards</font></li>



<li>

<font face="Arial,Helvetica">connecting an external power supply (if more

electronics is present)</font></li>



<li>

<font face="Arial,Helvetica">make it fully compatible with the cheaper

(and complexer) 16F627/16F628</font></li>

</ul>

</td>

</tr>



<tr>

<td><font face="Arial,Helvetica">October 2001</font></td>



<td>

<ul>

<li>

<font face="Arial,Helvetica">Idea added to increase the program voltage

in case of bad RS232 lines</font></li>

</ul>

</td>

</tr>



<tr>

<td><font face="Arial,Helvetica">Septemnber 2001</font></td>



<td>

<ul>

<li>

<font face="Arial,Helvetica">The first design</font></li>

</ul>

</td>

</tr>

</tbody>
</table>





<br>

&nbsp;

<br>

&nbsp;

</body></html>
