<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>1 PIC definition library structure</TITLE>
<META name="description" CONTENT="1 PIC definition library structure">
<META name="keywords" CONTENT="pjal_doc_a4">
<META name="resource-type" CONTENT="document">
<META name="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META name="generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" href="pjal_doc_a4.css">

<LINK REL="next" href="pjal_doc_a4_node23.html">
<LINK REL="previous" href="pjal_doc_a4_node21.html">
<LINK REL="up" href="pjal_doc_a4_node21.html">
<LINK REL="next" href="pjal_doc_a4_node23.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A name="tex2html567"
  href="pjal_doc_a4_node23.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" src="next.png"></A> 
<A name="tex2html563"
  href="pjal_doc_a4_node21.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" src="up.png"></A> 
<A name="tex2html557"
  href="pjal_doc_a4_node21.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" src="prev.png"></A> 
<A name="tex2html565"
  href="pjal_doc_a4_node2.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" src="contents.png"></A>  
<BR>
<B> Next:</B> <A name="tex2html568"
  href="pjal_doc_a4_node23.html">2 Other libraries</A>
<B> Up:</B> <A name="tex2html564"
  href="pjal_doc_a4_node21.html">3 Libraries</A>
<B> Previous:</B> <A name="tex2html558"
  href="pjal_doc_a4_node21.html">3 Libraries</A>
 &nbsp; <B>  <A name="tex2html566"
  href="pjal_doc_a4_node2.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A name="child_links"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A name="tex2html569"
  href="pjal_doc_a4_node22.html#section00611000000000000000">1 Chip definition file</A>
<LI><A name="tex2html570"
  href="pjal_doc_a4_node22.html#section00612000000000000000">2 Core definition file</A>
<LI><A name="tex2html571"
  href="pjal_doc_a4_node22.html#section00613000000000000000">3 PIC chip definition file</A>
<LI><A name="tex2html572"
  href="pjal_doc_a4_node22.html#section00614000000000000000">4 Example of usage</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A name="section00610000000000000000">
1 PIC definition library structure</A>
</H1>

<P>
<A name="sub:pic-libary-structure"></A>These libraries describes the core
of some PIC chips in order to use inside a <I>JAL 2.0</I> program.

<P>
<BR CLEAR="ALL">
<HR>
<P>

<H2><A name="section00611000000000000000">
1 Chip definition file</A>
</H2>

<P>
<A name="sub:chip-def-file"></A>The file <code>"chipdef.jal"</code> contains
constants needed by <I>JAL 2.0</I>.

<P>
The constant values that are assigned by <I>JAL 2.0</I> to <code>target_chip</code>
are:
<BR><PRE>   const pic_16f877 = 1
   const pic_16f628 = 2
   const pic_16c84 = 3
   const pic_16f84 = 4
   const pic_12c509a = 5
   const pic_12f675 = 6
   const pic_18f242 = 7
   const pic_18f252 = 8
   const pic_18f452 = 9
   const pic_SX18 = 10
   const pic_SX28 = 11
   const pic_SX = 12
</PRE>

<P>
Other constants defining different PICs may be added by the user,
as long a <I>core definition</I> file<A name="tex2html37"
  href="#foot1630"><SUP><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" src="footnote.png"></SUP></A> and a <I>PIC chip definition</I> file<A name="tex2html38"
  href="#foot1631"><SUP><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" src="footnote.png"></SUP></A> are also generated.

<P>
The constant values that are assigned by <I>JAL 2.0</I> to <code>target_cpu</code>&nbsp;are:

<P>
<PRE>   const pic_12 = 1
   const pic_14 = 2
   const pic_16 = 3
   const sx_12  = 4
</PRE>

<P>
Other constants used widely:

<P>
<PRE>   const bit  on    = 1
   const bit  off   = 0
   const byte w     = 0
   const byte f     = 1
   const bit  true  = 1
   const bit  false = 0
   const bit  high  = 1
   const bit  low   = 0
</PRE>

<P>
<I>JAL 2.0</I> control bit, only useful if you are sharing libraries with
<I>JAL 2.0</I> and JAL:

<P>
<PRE>   const bit  PJAL  = 1
</PRE>

<P>
<BR CLEAR="ALL">
<HR>
<P>

<H2><A name="section00612000000000000000">
2 Core definition file</A>
</H2>

<P>
<A name="sub:core-definition-file"></A> Describes internal hardware structure
of a subset of Microchip <SUP><SMALL>TM</SMALL></SUP>&nbsp;PICs. As reference, here
is the <code>"c16f87x.jal"</code> file structure that covers all PIC16F87x
subset.

<P>
In the <U>first line</U> must be an <I>include</I> to Core definition
file<A name="tex2html39"
  href="#foot1632"><SUP><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" src="footnote.png"></SUP></A>:

<P>
<PRE>   include chipdef
</PRE>

<P>
Following the type of CPU :

<P>
<PRE>   const target_cpu = pic_14
</PRE>

<P>
Number of Stack levels :

<P>
<PRE>   pragma stack  8
</PRE>

<P>
<I>Configuration word</I> address and default value :

<P>
<PRE>   const word _fuses     = 0x3fff ; default value
   const word _fuse_base = 0x2007 ; address
</PRE>

<P>
For PICs with several <I>configuration words</I> (ie: PIC16F88):

<P>
<PRE>   const word _fuses_ct             = 2
   const word _fuses[_fuses_ct]     = {0x3fff, 0x3fff} ; default value
   const word _fuse_base[_fuses_ct] = {0x2007, 0x2008} ; where to put it
</PRE>

<P>
Minimal set of SFRs needed by <I>JAL 2.0</I>. You are warned not to change
names, these must begin with underscore:

<P>
<PRE>   var volatile byte _pic_isr_w 
       at {0x007f, 0x00ff, 0x017f, 0x01ff }
   var volatile byte _ind  
       at {0x0000, 0x0080, 0x0100, 0x0180}
   var volatile byte _pcl 
       at {0x0002, 0x0082, 0x0102, 0x0182}
   var volatile byte _status 
       at {0x0003, 0x0083, 0x0103, 0x0183}
   var volatile byte _fsr    
       at {0x0004, 0x0084, 0x0104, 0x0184}
   var volatile byte _pclath
       at {0x000a, 0x008a, 0x010a, 0x018a}
</PRE>

<P>
Bit position of <I>STATUS</I> flags :

<P>
<PRE>   const        byte _irp    = 7
   const        byte _rp1    = 6
   const        byte _rp0    = 5
   const        byte _not_to = 4
   const        byte _not_pd = 3
   const        byte _z      = 2
   const        byte _dc     = 1
   const        byte _c      = 0
</PRE>

<P>
Details of <I>configuration word</I> fuses :

<P>
<PRE>   pragma fuse_def protection 0b11000000110000 {
   on  = 0b00000000000000
   off = 0b11000000110000
   }

   pragma fuse_def debug      0b00100000000000 {
   on  = 0b00000000000000
   off = 0b00100000000000
   }

   pragma fuse_def cdp        0b00000100000000 {
   on  = 0b00000000000000
   off = 0b00000100000000
   }

   pragma fuse_def lvp        0b00000010000000 {
   on  = 0b00000010000000
   off = 0b00000000000000
   }

   pragma fuse_def bor        0b00000001000000 {
   on  = 0b00000001000000
   off = 0b00000000000000
   }

   pragma fuse_def powerup    0b00000000001000 {
   off = 0b00000000001000
   on  = 0b00000000000000
   }

   pragma fuse_def watchdog   0b00000000000100 {
   off = 0b00000000000000
   on  = 0b00000000000100
   }

   pragma fuse_def osc        0b00000000000011 {
   lp  = 0b00000000000000
   xt  = 0b00000000000001
   hs  = 0b00000000000010
   rc  = 0x00000000000011
   }
</PRE>

<P>
For PICs with several <I>configuration words</I> (ie: PIC16F88):

<P>
<PRE>   pragma fuse_def IESO:1 0b0_0000_0000_0010 {
      ENABLED  = 0b0_0000_0000_0010
      DISABLED = 0b0_0000_0000_0000
   }

   pragma fuse_def FCMEN:1 0b0_0000_0000_0001 {
      ENABLED  = 0b0_0000_0000_0001
      DISABLED = 0b0_0000_0000_0000
   }
</PRE>

<P>
<BR CLEAR="ALL">
<HR>
<P>

<H2><A name="section00613000000000000000">
3 PIC chip definition file</A>
</H2>

<P>
<A name="sub:pic-chip-definition"></A>This file describes an specific PIC
chip, distinguishing it from the rest of PICs of the subset. As reference,
here is the <code>"c16f877.jal"</code> file structure for PIC16F877 PIC
chip.

<P>
In the <U>first line</U> must be an <I>include</I> to the <I>Core
definition</I> file<A name="tex2html40"
  href="#foot1633"><SUP><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" src="footnote.png"></SUP></A>:

<P>
<PRE>   include c16f87x
</PRE>

<P>
Following chip, RAM, ROM and EEPROM memory ranges :

<P>
<PRE>   pragma target chip 16f877
   pragma data  0x0020-0x007f, 0x00a0-0x00ff,
                0x120-0x16f, 0x1a0-0x1ef
   pragma code  8192
   pragma eeprom 0x2100, 256
</PRE>

<P>
<BR CLEAR="ALL">
<HR>
<P>

<H2><A name="section00614000000000000000">
4 Example of usage</A>
</H2>

<P>
<A name="sub:example-of-usage"></A>
<P>
<PRE>   -- main program
   -- This must be in first line
   include c16f877

   -- Clock frequency
   const target_clock = 10_000_000

   -- main program
   var volatile byte a

   a = a + 1
</PRE>

<P>
Note: This small program compiles without errors.

<P>
<BR><HR><H4>Footnotes</H4>
<DL>
<DT><A name="foot1630">... file</A><A
 href="pjal_doc_a4_node22.html#tex2html37"><SUP><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" src="footnote.png"></SUP></A></DT>
<DD>See section <A href="#sub:core-definition-file">3.1.2</A>&nbsp;sub:Core-definition-file

</DD>
<DT><A name="foot1631">... file</A><A
 href="pjal_doc_a4_node22.html#tex2html38"><SUP><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" src="footnote.png"></SUP></A></DT>
<DD>See section <A href="#sub:pic-chip-definition">3.1.3</A>&nbsp;sub:PIC-chip-definition

</DD>
<DT><A name="foot1632">...
file</A><A
 href="pjal_doc_a4_node22.html#tex2html39"><SUP><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" src="footnote.png"></SUP></A></DT>
<DD>See section <A href="#sub:chip-def-file">3.1.1</A>&nbsp;sub:chip-def-file

</DD>
<DT><A name="foot1633">... file</A><A
 href="pjal_doc_a4_node22.html#tex2html40"><SUP><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" src="footnote.png"></SUP></A></DT>
<DD>See section <A href="#sub:core-definition-file">3.1.2</A>&nbsp;sub:Core-definition-file

</DD>
</DL><HR>
<!--Navigation Panel-->
<A name="tex2html567"
  href="pjal_doc_a4_node23.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" src="next.png"></A> 
<A name="tex2html563"
  href="pjal_doc_a4_node21.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" src="up.png"></A> 
<A name="tex2html557"
  href="pjal_doc_a4_node21.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" src="prev.png"></A> 
<A name="tex2html565"
  href="pjal_doc_a4_node2.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" src="contents.png"></A>  
<BR>
<B> Next:</B> <A name="tex2html568"
  href="pjal_doc_a4_node23.html">2 Other libraries</A>
<B> Up:</B> <A name="tex2html564"
  href="pjal_doc_a4_node21.html">3 Libraries</A>
<B> Previous:</B> <A name="tex2html558"
  href="pjal_doc_a4_node21.html">3 Libraries</A>
 &nbsp; <B>  <A name="tex2html566"
  href="pjal_doc_a4_node2.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<HR>pJAL Manual.<BR>(c) 2006 Javier Martinez, Vasile Surducan and Dave Lagzdin.
</ADDRESS>
</BODY>
</HTML>
